<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>æ©Ÿæ§‹è©³ç´°è³‡æ–™ - æ¨‚é½¡æ©‹ VitalBridge</title>
    <meta name="description" content="æŸ¥çœ‹é•·ç…§æ©Ÿæ§‹çš„è©³ç´°è³‡è¨Šï¼ŒåŒ…å«æœå‹™é …ç›®ã€è²»ç”¨ã€ç‰¹è‰²æœå‹™ç­‰å®Œæ•´è³‡æ–™">
    <meta name="keywords" content="é•·ç…§æ©Ÿæ§‹è©³ç´°è³‡æ–™,æ©Ÿæ§‹è³‡è¨Š,é•·ç…§æœå‹™,è²»ç”¨åƒ¹æ ¼">

    <!-- Open Graph tags -->
    <meta property="og:title" content="æ©Ÿæ§‹è©³ç´°è³‡æ–™ - æ¨‚é½¡æ©‹ VitalBridge">
    <meta property="og:description" content="æŸ¥çœ‹é•·ç…§æ©Ÿæ§‹çš„è©³ç´°è³‡è¨Šï¼ŒåŒ…å«æœå‹™é …ç›®ã€è²»ç”¨ã€ç‰¹è‰²æœå‹™ç­‰å®Œæ•´è³‡æ–™">
    <meta property="og:type" content="website">

    <!-- Favicons -->
    <link href="/assets/img/favicon.png" rel="icon">
    <link href="/assets/img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="/assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
    <link href="/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

    <!-- Main CSS File -->
    <link href="/assets/css/main.css" rel="stylesheet">

    <!-- è‡ªå·±æƒ³æ”¹çš„æ¨£å¼æ”¾é€™é‚Š -->
    <style>
        /* æ©Ÿæ§‹è©³ç´°é é¢è‡ªè¨‚æ¨£å¼ */
        .detail-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .org-title {
            color: #2c3e50;
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            border-bottom: 3px solid #007bff;
            padding-bottom: 0.5rem;
        }

        .org-location {
            color: #6c757d;
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }

        .bed-count {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            display: inline-block;
            font-weight: 600;
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
        }

        .org-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 2rem;
        }

        .section-title {
            color: #2c3e50;
            font-weight: 600;
            border-left: 4px solid #007bff;
            padding-left: 1rem;
            margin: 2rem 0 1rem 0;
            font-size: 1.6rem;
        }

        .service-targets {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .service-target-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .age-limit-section .alert {
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #d1ecf1 0%, #b8daff 100%);
            border-left: 5px solid #17a2b8;
            font-size: 1.4rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 0;
        }

        .age-limit-section .alert strong {
            color: #0c5460;
        }

        .price-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            border: none;
        }

        .price-table th {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            font-weight: 700;
            font-size: 1.3rem;
            padding: 1.2rem 1rem;
            border: none;
            text-align: center;
        }

        .price-table td {
            padding: 1.5rem 1rem;
            border-bottom: 1px solid #e9ecef;
            vertical-align: middle;
            font-size: 1.2rem;
        }

        .price-table tr:hover {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .price-table .room-name {
            font-weight: 700;
            font-size: 1.4rem;
            color: #2c3e50;
        }

        .price-table .monthly-price {
            font-weight: 800;
            font-size: 1.6rem;
            color: #28a745;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .price-table .room-quantity {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .price-table .deposit-info {
            font-size: 1.3rem;
            line-height: 1.6;
        }

        .price-table .deposit-amount {
            font-weight: 600;
            color: #6c757d;
            font-size: 1.3rem;
        }

        .price-table .deposit-months {
            font-size: 1.2rem;
            color: #6c757d;
            margin-top: 0.2rem;
        }

        .price-table .no-deposit {
            font-weight: 600;
            color: #28a745;
            font-size: 1.3rem;
        }

        .feature-services {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .feature-item {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .feature-item:hover {
            transform: translateY(-5px);
            border-color: #ffc107;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .feature-icon {
            font-size: 2rem;
            color: #ffc107;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 60px;
            height: 60px;
            margin: 0 auto 0.5rem;
        }

        .feature-service-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }

        .feature-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .description-section {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            line-height: 1.8;
            font-size: 1.1rem;
        }

        /* è¯çµ¡è³‡è¨Šç›¸é—œæ¨£å¼ - æš«æ™‚è¨»è§£
        .address-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .address-link {
            color: #1976d2;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: color 0.3s ease;
        }

        .address-link:hover {
            color: #0d47a1;
            text-decoration: underline;
        }
        */

        /* åœ°åœ–ç›¸é—œæ¨£å¼ */
        .map-container {
            position: relative;
            width: 100%;
            height: 550px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
            margin: 2rem 0;
        }

        .map-info-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 12;
            max-width: 320px;
            min-width: 280px;
        }

        .map-info-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .map-address {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            line-height: 1.3;
        }

        .address-line1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .address-line2 {
            font-size: 24px;
            font-weight: 600;
        }

        .map-detail-link {
            font-size: 20px;
            color: #1976d2;
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: color 0.3s ease;
        }

        .map-detail-link:hover {
            color: #0d47a1;
            text-decoration: underline;
        }

        .back-btn {
            background: linear-gradient(45deg, #6c757d, #495057);
            border: none;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
            color: white;
        }

        .loading-container {
            text-align: center;
            padding: 4rem;
            color: #6c757d;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 2rem 0;
            text-align: center;
        }

        .breadcrumb {
            background: transparent;
            padding: 0;
            margin-bottom: 1rem;
        }

        .breadcrumb-item+.breadcrumb-item::before {
            content: ">";
            color: #6c757d;
        }

        /* é˜²æ­¢ Vue è¼‰å…¥å‰çš„é–ƒçˆ */
        [v-cloak] {
            display: none !important;
        }

        /* åˆå§‹éš±è— Vue æ‡‰ç”¨ï¼Œè¼‰å…¥å®Œæˆå¾Œé¡¯ç¤º */
        #detailApp {
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #detailApp.vue-loaded {
            opacity: 1;
        }

        /* é˜²æ­¢æ¨¡æ¿å­—ç¬¦ä¸²é–ƒçˆ */
        .loading-container,
        .detail-container,
        .back-btn {
            transition: all 0.3s ease;
        }

        .info-badge {
            background: #007bff;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 1.0rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }

        /* æ©Ÿæ§‹ä»‹ç´¹æ–‡å­—æ¨£å¼ */
        .description-section p {
            font-size: 1.3rem;
            line-height: 1.8;
            color: #2c3e50;
        }

        /* æœå‹™å°è±¡é …ç›®æ–‡å­— */
        .service-target-item h6 {
            font-size: 1.2rem;
        }

        /* å…¶ä»–è³‡è¨Šæ–‡å­— */
        .col-md-6,
        .col-md-12 {
            font-size: 1.2rem;
        }

        /* éºµåŒ…å±‘å°èˆª */
        .breadcrumb {
            font-size: 1.1rem;
        }

        /* è¿”å›æŒ‰éˆ• */
        .back-btn {
            font-size: 1.1rem;
        }

        /* è¼‰å…¥å’ŒéŒ¯èª¤è¨Šæ¯ */
        .loading-container h3 {
            font-size: 1.4rem;
        }

        .error-message {
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .detail-container {
                padding: 1rem;
            }

            .org-image {
                height: 250px;
            }

            .feature-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        /* æµ®å‹•è¿”å›æŒ‰éˆ•æ¨£å¼ */
        .floating-back-btn {
            position: fixed;
            bottom: 30px;
            right: 100px;
            /* èª¿æ•´åˆ°ç¶ è‰²ç½®é ‚æŒ‰éˆ•å·¦é‚Šï¼Œä¿æŒé–“è· */
            background: linear-gradient(45deg, #6c757d, #495057);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: scale(0.8);
        }

        .floating-back-btn.show {
            opacity: 1;
            visibility: visible;
            transform: scale(1);
        }

        .floating-back-btn:hover {
            background: linear-gradient(45deg, #495057, #343a40);
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
            color: white;
        }

        .floating-back-btn:active {
            transform: scale(0.95);
        }

        /* æ‰‹æ©Ÿç‰ˆèª¿æ•´ */
        @media (max-width: 768px) {
            .floating-back-btn {
                width: 50px;
                height: 50px;
                bottom: 20px;
                right: 80px;
                /* æ‰‹æ©Ÿç‰ˆä¹Ÿèª¿æ•´ä½ç½®ï¼Œé¿å…èˆ‡ç½®é ‚æŒ‰éˆ•é‡ç–Š */
                font-size: 1.2rem;
            }
        }
    </style>

</head>

<body>
    <div class="headerpage"></div>

    <main class="main">
        <!-- Breadcrumb Navigation -->
        <section class="py-2">
            <div class="container">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/VitalBridge/index.html">é¦–é </a></li>
                        <li class="breadcrumb-item"><a href="/VitalBridge/orgs/orgSearch.html">æ‰¾æ©Ÿæ§‹</a></li>
                        <li class="breadcrumb-item active" aria-current="page">æ©Ÿæ§‹è©³ç´°è³‡æ–™</li>
                    </ol>
                </nav>
            </div>
        </section>

        <!-- Detail Section -->
        <section id="detailApp" class="section" v-cloak>
            <div class="container">
                <!-- Back Button -->
                <button type="button" class="btn back-btn" @click="goBack" aria-label="è¿”å›æœå°‹é é¢">
                    <i class="bi bi-arrow-left me-2"></i>è¿”å›æœå°‹
                </button>

                <!-- Loading State -->
                <div v-if="loading" class="loading-container">
                    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">è¼‰å…¥ä¸­...</span>
                    </div>
                    <h3 class="mt-3">è¼‰å…¥æ©Ÿæ§‹è³‡æ–™ä¸­...</h3>
                </div>

                <!-- Error State -->
                <div v-else-if="errorMessage" class="error-message" role="alert">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    {{ errorMessage }}
                    <div class="mt-3">
                        <button type="button" class="btn btn-primary" @click="loadOrganizationDetail">
                            <i class="bi bi-arrow-clockwise me-2"></i>é‡æ–°è¼‰å…¥
                        </button>
                    </div>
                </div>

                <!-- Organization Detail -->
                <div v-if="!loading && organization.name && !errorMessage" class="detail-container">
                    <!-- 1. æ©Ÿæ§‹åç¨± -->
                    <h1 class="org-title">{{ organization.name }}</h1>

                    <!-- 2. ä½ç½®èˆ‡åºŠä½æ•¸ -->
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <p class="org-location">
                                <i class="bi bi-geo-alt me-2"></i>
                                {{ organization.cityName }}{{ organization.districtName }}
                            </p>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <span class="bed-count">
                                <i class="bi bi-hospital me-2"></i>
                                åºŠä½æ•¸ï¼š{{ organization.bedCount }} åºŠ
                            </span>
                        </div>
                    </div>

                    <!-- 3. æ©Ÿæ§‹ç…§ç‰‡ -->
                    <div v-if="organization.photoUrl">
                        <img :src="getImageUrl(organization.photoUrl)" :alt="organization.name + 'æ©Ÿæ§‹ç…§ç‰‡'"
                            class="org-image" @error="handleImageError($event)">
                    </div>

                    <!-- 4. æœå‹™å°è±¡ -->
                    <div v-if="organization.serviceTargetNames && organization.serviceTargetNames.length > 0">
                        <h3 class="section-title">
                            <i class="bi bi-people me-2"></i>æœå‹™å°è±¡
                        </h3>
                        <div class="row g-2">
                            <div v-for="target in organization.serviceTargetNames" :key="target"
                                class="col-md-3 col-sm-6">
                                <div class="service-target-item">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-check-circle-fill text-success me-2"></i>
                                        <div>
                                            <h6 class="mb-0 fw-bold">{{ target }}</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- å¹´é½¡é™åˆ¶è³‡è¨Š -->
                        <div class="age-limit-section mt-3">
                            <div class="alert alert-info d-flex align-items-center" role="alert">
                                <i class="bi bi-info-circle-fill me-2"></i>
                                <div>
                                    <strong>å¹´é½¡é™åˆ¶ï¼š</strong>{{ organization.ageLimits || 'ç„¡ç‰¹åˆ¥é™åˆ¶' }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 4.1 è£œåŠ©è³‡è¨Š -->
                    <div v-if="organization.subsidyInfoDescriptions && organization.subsidyInfoDescriptions.length > 0">
                        <h3 class="section-title">
                            <i class="bi bi-cash-coin me-2"></i>è£œåŠ©è³‡è¨Š
                        </h3>
                        <div class="row g-2">
                            <div v-for="subsidy in organization.subsidyInfoDescriptions" :key="subsidy"
                                class="col-md-6 col-sm-12">
                                <div class="service-target-item">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-check-circle-fill text-primary me-2"></i>
                                        <div>
                                            <h6 class="mb-0 fw-bold">{{ subsidy }}</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 5. æˆ¿å‹èˆ‡åƒ¹æ ¼ -->
                    <div v-if="organization.rooms && organization.rooms.length > 0">
                        <h3 class="section-title">
                            <i class="bi bi-house me-2"></i>æˆ¿å‹èˆ‡è²»ç”¨
                        </h3>
                        <div class="table-responsive">
                            <table class="table price-table">
                                <thead>
                                    <tr>
                                        <th>ğŸ  æˆ¿å‹åç¨±</th>
                                        <th>ğŸ’° æœˆè²» (NT$)</th>
                                        <th>ğŸ”¢ æˆ¿é–“æ•¸é‡</th>
                                        <th>ğŸ“‹ æŠ¼é‡‘è³‡è¨Š</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="room in organization.rooms" :key="room.id">
                                        <td class="text-center">
                                            <div class="room-name">{{ room.roomTypeName }}</div>
                                        </td>
                                        <td class="text-center">
                                            <div class="monthly-price">
                                                {{ formatPrice(room.monthlyPrice) }}
                                            </div>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-primary room-quantity">{{ room.roomQuantity }}
                                                é–“</span>
                                        </td>
                                        <td class="text-center">
                                            <div v-if="room.hasDeposit" class="deposit-info">
                                                <div class="deposit-amount">
                                                    æŠ¼é‡‘ï¼š{{ formatPrice(room.depositAmount) }}
                                                </div>
                                                <div v-if="room.depositMonths" class="deposit-months">
                                                    ç´„ {{ room.depositMonths }} å€‹æœˆ
                                                </div>
                                            </div>
                                            <div v-else class="no-deposit">
                                                âœ“ ç„¡éœ€æŠ¼é‡‘
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 6. ç‰¹è‰²æœå‹™ -->
                    <div v-if="organization.featureServices && organization.featureServices.length > 0">
                        <h3 class="section-title">
                            <i class="bi bi-star me-2"></i>ç‰¹è‰²æœå‹™
                        </h3>
                        <div class="feature-services">
                            <div class="feature-grid">
                                <div v-for="service in organization.featureServices" :key="service.id"
                                    class="feature-item">
                                    <div class="feature-icon">
                                        <!-- ä½¿ç”¨å¾Œå°åœ–ç‰‡ï¼Œfallback åˆ° Bootstrap åœ–ç¤º -->
                                        <img v-if="getFeatureServiceImage(service.name)"
                                            :src="getFeatureServiceImage(service.name)" :alt="service.name"
                                            class="feature-service-img" loading="lazy"
                                            @error="handleFeatureServiceImageError($event)">
                                        <i v-else :class="getServiceIcon(service.name)"></i>
                                    </div>
                                    <div class="feature-name">{{ service.name }}</div>
                                    <div v-if="service.description" class="text-muted small mt-2">
                                        {{ service.description }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 7. æ©Ÿæ§‹ä»‹ç´¹ -->
                    <div v-if="organization.description">
                        <h3 class="section-title">
                            <i class="bi bi-info-circle me-2"></i>æ©Ÿæ§‹ä»‹ç´¹
                        </h3>
                        <div class="description-section">
                            <p class="mb-0" style="white-space: pre-line;">{{ organization.description }}</p>
                        </div>
                    </div>

                    <!-- 8. è¯çµ¡è³‡è¨Š - æš«æ™‚è¨»è§£ï¼Œæ”¹ç”¨åœ°åœ–é¡¯ç¤ºåœ°å€è³‡è¨Š
                    <div>
                        <h3 class="section-title">
                            <i class="bi bi-telephone me-2"></i>è¯çµ¡è³‡è¨Š
                        </h3>
                        <div class="address-section">
                            <div class="row">
                                <div class="col-md-12">
                                    <h6>å®Œæ•´åœ°å€</h6>
                                    <a :href="getOrganizationMapUrl()" target="_blank" class="address-link"
                                        rel="noopener noreferrer"
                                        :aria-label="'åœ¨ Google åœ°åœ–ä¸­æŸ¥çœ‹' + organization.cityName + organization.districtName + organization.address">
                                        <i class="bi bi-geo-alt-fill"></i>
                                        {{ organization.cityName }}{{ organization.districtName }}{{
                                        organization.address }}
                                        <i class="bi bi-box-arrow-up-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    -->

                    <!-- 9. ä½ç½®åœ°åœ– -->
                    <div>
                        <h3 class="section-title">
                            <i class="bi bi-map me-2"></i>ä½ç½®åœ°åœ–
                        </h3>
                        <div class="map-container">
                            <!-- åœ°åœ–å·¦ä¸Šè§’è³‡è¨Šæ¡† -->
                            <div class="map-info-overlay">
                                <div class="map-info-content">
                                    <div class="map-address">
                                        <div class="address-line1">{{ organization.cityName }}{{
                                            organization.districtName }}</div>
                                        <div class="address-line2">{{ organization.address }}</div>
                                    </div>
                                    <a :href="getOrganizationMapUrl()" target="_blank" class="map-detail-link"
                                        rel="noopener noreferrer">
                                        <i class="bi bi-geo-alt-fill me-1"></i>é¡¯ç¤ºè©³ç´°åœ°åœ–
                                        <i class="bi bi-box-arrow-up-right ms-1"></i>
                                    </a>
                                </div>
                            </div>
                            <!-- åœ°åœ–iframe -->
                            <iframe id="orgMap" width="100%" height="550" :src="getEmbedMapUrl()" style="border:0;"
                                allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"
                                :title="organization.name + 'ä½ç½®åœ°åœ–'">
                            </iframe>
                        </div>
                    </div>

                    <!-- å…¶ä»–è³‡è¨Š -->
                    <div class="row mt-4">
                        <div class="col-md-6" v-if="organization.establishedYear">
                            <span class="info-badge">æˆç«‹å¹´ä»½</span>
                            {{ organization.establishedYear }} å¹´
                        </div>
                        <div class="col-md-6" v-if="organization.licenseNumber">
                            <span class="info-badge">è¨±å¯è­‰è™Ÿ</span>
                            {{ organization.licenseNumber }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- æµ®å‹•è¿”å›æŒ‰éˆ• -->
            <button type="button" class="floating-back-btn" :class="{ 'show': showFloatingBtn }" @click="goBack"
                aria-label="è¿”å›æœå°‹é é¢" title="è¿”å›æœå°‹">
                <i class="bi bi-arrow-left"></i>
            </button>
        </section>
    </main>

    <div class="footerpage"></div>

    <!-- Scroll Top -->
    <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>
    <!-- Preloader -->
    <div id="preloader"></div>

    <!-- Vendor JS Files -->
    <script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/vendor/php-email-form/validate.js"></script>
    <script src="/assets/vendor/aos/aos.js"></script>
    <script src="/assets/vendor/waypoints/noframework.waypoints.js"></script>
    <script src="/assets/vendor/purecounter/purecounter_vanilla.js"></script>
    <script src="/assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="/assets/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="/assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>

    <!-- å…¶ä»–è¦è£çš„jsæ”¾åœ¨é€™ä¹‹å‰ -->
    <script src="/assets/js/fragment-loader.js" defer></script>

</body>

<!-- Simple page hook: åœ¨ä¸‹é¢å€å¡Šç›´æ¥å¯«é é¢å°ˆå±¬çš„ JSï¼ˆæ­¤å‡½å¼æœƒç­‰åˆ° fragment-loader ç™¼å‡º app:ready ä¸” window.load å®Œæˆå¾ŒåŸ·è¡Œï¼‰ -->
<script>
    (function onFullyReady(run) {
        function once(ev) { return new Promise(res => { function h(e) { window.removeEventListener(ev, h); res(e); } window.addEventListener(ev, h); }); }
        function waitAppReady() { if (window.appReadyAt !== undefined) return Promise.resolve(); return once('app:ready'); }
        function waitWindowLoad() { if (document.readyState === 'complete') return Promise.resolve(); return once('load'); }
        Promise.all([waitAppReady(), waitWindowLoad()]).then(run).catch(function (e) { console.error('post-load hook error', e); });
    })(function () {
        // ===== åœ¨ä¸‹é¢æ”¾é é¢å°ˆå±¬çš„ JSï¼ˆåªæœƒåœ¨æ‰€æœ‰ç‰‡æ®µèˆ‡è³‡æºè¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œï¼‰ =====

        //Vueçš„éƒ¨åˆ†å¯«é€™é‚Š
        (function mountVue() {
            // æŠŠé é¢å°ˆå±¬çš„ Vue ç¨‹å¼å¯«åœ¨é€™å€‹å‡½å¼è£¡
            function initPageVue() {
                if (typeof Vue === 'undefined') return; // è‹¥æœªè¼‰å…¥ Vue å‰‡è·³é
                if (typeof axios === 'undefined') return; // è‹¥æœªè¼‰å…¥ axios å‰‡è·³é

                const { createApp } = Vue;

                // API é…ç½®å¸¸æ•¸
                const API_BASE_URL = 'https://localhost:7104';
                const BACKEND_BASE_URL = 'https://localhost:7184'; // å¾Œå° API åŸºç¤ URL

                // Axios é…ç½®
                const apiClient = axios.create({
                    baseURL: API_BASE_URL,
                    timeout: 30000,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                // Axios éŒ¯èª¤æ””æˆªå™¨
                apiClient.interceptors.response.use(
                    response => response,
                    error => {
                        console.error('API Error:', error);
                        let errorMessage = 'ç¶²è·¯é€£ç·šç•°å¸¸ï¼Œè«‹ç¨å¾Œå†è©¦';

                        if (error.response) {
                            if (error.response.status === 404) {
                                errorMessage = 'æ‰¾ä¸åˆ°æŒ‡å®šçš„æ©Ÿæ§‹ï¼Œå¯èƒ½å·²è¢«ç§»é™¤æˆ–ä¸å­˜åœ¨';
                            } else {
                                errorMessage = `ä¼ºæœå™¨éŒ¯èª¤ (${error.response.status})`;
                            }
                        } else if (error.request) {
                            errorMessage = 'ç„¡æ³•é€£ç·šåˆ°ä¼ºæœå™¨ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š';
                        }

                        return Promise.reject({ message: errorMessage, originalError: error });
                    }
                );

                createApp({
                    data() {
                        return {
                            organization: {},
                            loading: true,
                            errorMessage: '',
                            organizationId: null,
                            showFloatingBtn: false,
                            mapSrc: '',
                            // ç‰¹è‰²æœå‹™è³‡æ–™å¿«å–
                            featureServicesCache: new Map()
                        };
                    },

                    async mounted() {
                        console.log('Vue mounted - é–‹å§‹è¼‰å…¥æ©Ÿæ§‹è©³ç´°è³‡æ–™');
                        this.organizationId = this.getOrganizationIdFromUrl();
                        console.log('Organization ID from URL:', this.organizationId);

                        if (!this.organizationId) {
                            this.errorMessage = 'ç¼ºå°‘æ©Ÿæ§‹ ID åƒæ•¸ï¼Œè«‹å¾æœå°‹é é¢é€²å…¥';
                            this.loading = false;
                            console.log('âŒ ç¼ºå°‘æ©Ÿæ§‹ ID');
                            return;
                        }

                        // è¼‰å…¥ç‰¹è‰²æœå‹™è³‡æ–™
                        await this.loadFeatureServices();

                        await this.loadOrganizationDetail();

                        // æ·»åŠ æ»¾å‹•ç›£è½å™¨
                        this.setupScrollListener();
                    },

                    beforeUnmount() {
                        // ç§»é™¤æ»¾å‹•ç›£è½å™¨
                        window.removeEventListener('scroll', this.handleScroll);
                    },

                    methods: {
                        // å¾ URL å–å¾—æ©Ÿæ§‹ ID
                        getOrganizationIdFromUrl() {
                            const urlParams = new URLSearchParams(window.location.search);
                            const id = urlParams.get('id');

                            if (id && !isNaN(id)) {
                                return parseInt(id);
                            }
                            return null;
                        },

                        // è¼‰å…¥æ©Ÿæ§‹è©³ç´°è³‡æ–™
                        async loadOrganizationDetail() {
                            this.loading = true;
                            this.errorMessage = '';
                            console.log(`ğŸ”„ é–‹å§‹è¼‰å…¥æ©Ÿæ§‹ ID: ${this.organizationId}`);

                            try {
                                const response = await apiClient.get(`/api/Organizations/${this.organizationId}`);
                                console.log('âœ… API å›æ‡‰æˆåŠŸ:', response.data);
                                console.log('ğŸ—ºï¸ æª¢æŸ¥åœ°åœ–ç›¸é—œæ¬„ä½:', {
                                    mapUrl: response.data.mapUrl,
                                    googleMapUrl: response.data.googleMapUrl,
                                    googleMapsUrl: response.data.googleMapsUrl,
                                    map_url: response.data.map_url,
                                    locationUrl: response.data.locationUrl
                                });
                                this.organization = response.data;

                                // æ›´æ–°é é¢æ¨™é¡Œ
                                if (this.organization.name) {
                                    document.title = `${this.organization.name} - æ©Ÿæ§‹è©³ç´°è³‡æ–™ - æ¨‚é½¡æ©‹ VitalBridge`;
                                }

                            } catch (error) {
                                console.error('âŒ è¼‰å…¥æ©Ÿæ§‹è©³ç´°è³‡æ–™å¤±æ•—:', error);
                                console.error('âŒ éŒ¯èª¤è©³æƒ…:', error.response?.data);
                                this.errorMessage = error.message;
                            } finally {
                                this.loading = false;
                                console.log(`âœ… è¼‰å…¥å®Œæˆ - Loading: ${this.loading}, Organization: ${!!this.organization}, Error: ${this.errorMessage}`);
                            }
                        },

                        // è¿”å›æœå°‹é é¢
                        goBack() {
                            // å„ªå…ˆä½¿ç”¨ç€è¦½å™¨çš„è¿”å›åŠŸèƒ½ï¼Œé€™æ¨£å¯ä»¥ä¿æŒæœå°‹ç‹€æ…‹
                            if (window.history.length > 1 && document.referrer.includes('orgSearch.html')) {
                                window.history.back();
                            } else {
                                // ç›´æ¥è·³è½‰åˆ°æœå°‹é é¢ï¼ˆæœƒè§¸ç™¼æœå°‹æ¢ä»¶æ¢å¾©é‚è¼¯ï¼‰
                                window.location.href = '/orgs/orgSearch.html';
                            }
                        },

                        // è¨­ç½®æ»¾å‹•ç›£è½å™¨
                        setupScrollListener() {
                            this.handleScroll = () => {
                                // ç•¶é é¢æ»¾å‹•è¶…é 300px æ™‚é¡¯ç¤ºæµ®å‹•æŒ‰éˆ•
                                this.showFloatingBtn = window.pageYOffset > 300;
                            };

                            window.addEventListener('scroll', this.handleScroll);
                        },

                        // æ ¼å¼åŒ–åƒ¹æ ¼
                        formatPrice(price) {
                            return new Intl.NumberFormat('zh-TW').format(price);
                        },

                        // åœ–ç‰‡è¼‰å…¥éŒ¯èª¤è™•ç†
                        handleImageError(event) {
                            const img = event.target;
                            // é¿å…ç„¡é™å¾ªç’°è¼‰å…¥éŒ¯èª¤
                            img.onerror = null;
                            // éš±è—åœ–ç‰‡ä¸¦é¡¯ç¤ºé è¨­æ¨£å¼
                            img.style.display = 'none';

                            // åœ¨çˆ¶å®¹å™¨ä¸­é¡¯ç¤ºé è¨­åœ–ç‰‡æ¨£å¼
                            const parent = img.parentElement;
                            if (parent && !parent.querySelector('.no-image-placeholder')) {
                                const placeholder = document.createElement('div');
                                placeholder.className = 'no-image-placeholder';
                                placeholder.style.cssText = `
                                    width: 100%;
                                    height: 400px;
                                    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                                    border: 2px dashed #dee2e6;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    border-radius: 15px;
                                    color: #6c757d;
                                    font-size: 1.2rem;
                                    margin-bottom: 2rem;
                                `;
                                placeholder.innerHTML = 'ğŸ“·<br>æš«ç„¡æ©Ÿæ§‹ç…§ç‰‡';
                                parent.appendChild(placeholder);
                            }
                        },

                        // å–å¾—æœå‹™åœ–ç¤º
                        getServiceIcon(serviceName) {
                            const iconMap = {
                                'å¾©å¥æ²»ç™‚': 'bi-heart-pulse',
                                'æ—¥é–“ç…§è­·': 'bi-sun',
                                'è­·ç†æœå‹™': 'bi-hospital',
                                'åœ¨å®…é¤Šè­·': 'bi-house-heart',
                                'ç‡Ÿé¤Šé¤é£Ÿ': 'bi-cup-hot',
                                'äº¤é€šæ¥é€': 'bi-bus-front',
                                'å¨›æ¨‚æ´»å‹•': 'bi-music-note-beamed',
                                'å¥åº·æª¢æŸ¥': 'bi-clipboard-pulse',
                                'è—¥ç‰©ç®¡ç†': 'bi-capsule',
                                'å¿ƒç†è¼”å°': 'bi-chat-heart',
                                'ç‰©ç†æ²»ç™‚': 'bi-person-arms-up',
                                'è·èƒ½æ²»ç™‚': 'bi-tools',
                                'èªè¨€æ²»ç™‚': 'bi-chat-dots',
                                'ç¤¾å·¥æœå‹™': 'bi-people',
                                'å®¶å±¬æ”¯æŒ': 'bi-house-heart-fill'
                            };

                            return iconMap[serviceName] || 'bi-star-fill';
                        },

                        // å–å¾—æ©Ÿæ§‹åœ°åœ– URL (å„ªå…ˆä½¿ç”¨å¾Œå°æä¾›çš„é€£çµ)
                        getOrganizationMapUrl() {
                            // å„ªå…ˆä½¿ç”¨å¾Œå°æä¾›çš„åœ°åœ–é€£çµ (å¯èƒ½çš„æ¬„ä½åç¨±)
                            if (this.organization && (
                                this.organization.mapUrl ||
                                this.organization.googleMapUrl ||
                                this.organization.googleMapsUrl ||
                                this.organization.map_url ||
                                this.organization.locationUrl
                            )) {
                                return this.organization.mapUrl ||
                                    this.organization.googleMapUrl ||
                                    this.organization.googleMapsUrl ||
                                    this.organization.map_url ||
                                    this.organization.locationUrl;
                            }

                            // fallback åˆ°è‡ªå‹•ç”Ÿæˆçš„ Google Maps é€£çµ
                            if (this.organization) {
                                const fullAddress = `${this.organization.cityName}${this.organization.districtName}${this.organization.address}`;
                                return this.getGoogleMapsUrl(fullAddress);
                            }

                            return '#';
                        },

                        // å–å¾—åµŒå…¥åœ°åœ–çš„ URL
                        getEmbedMapUrl() {
                            if (!this.organization) return '';

                            const fullAddress = `${this.organization.cityName}${this.organization.districtName}${this.organization.address}`;
                            const encodedAddress = encodeURIComponent(fullAddress);

                            // ä½¿ç”¨å…è²»çš„ Google Maps iframe (ä¸éœ€è¦ API key)
                            return `https://www.google.com/maps?q=${encodedAddress}&output=embed`;
                        },

                        // å–å¾— Google Maps URL
                        getGoogleMapsUrl(address) {
                            const encodedAddress = encodeURIComponent(address);
                            return `https://www.google.com/maps/search/?api=1&query=${encodedAddress}`;
                        },

                        // è¼‰å…¥ç‰¹è‰²æœå‹™è³‡æ–™
                        async loadFeatureServices() {
                            try {
                                const response = await axios.get(`${API_BASE_URL}/api/Organizations/feature-services`);
                                response.data.forEach(service => {
                                    this.featureServicesCache.set(service.name, service.imageUrl);
                                });
                            } catch (error) {
                                // ç‰¹è‰²æœå‹™è¼‰å…¥å¤±æ•—ä¸å½±éŸ¿ä¸»è¦åŠŸèƒ½
                                console.log('ç‰¹è‰²æœå‹™è¼‰å…¥å¤±æ•—:', error);
                            }
                        },

                        // å–å¾—ç‰¹è‰²æœå‹™åœ–ç‰‡
                        getFeatureServiceImage(serviceName) {
                            const imageUrl = this.featureServicesCache.get(serviceName);

                            if (imageUrl) {
                                return this.getImageUrl(imageUrl);
                            }

                            return null;
                        },

                        // ç‰¹è‰²æœå‹™åœ–ç‰‡è¼‰å…¥éŒ¯èª¤è™•ç†
                        handleFeatureServiceImageError(event) {
                            const img = event.target;
                            const parent = img.parentElement;

                            // ç§»é™¤åœ–ç‰‡
                            img.remove();

                            // æ·»åŠ  fallback åœ–ç¤º
                            if (parent && !parent.querySelector('i')) {
                                const icon = document.createElement('i');
                                const serviceName = img.alt;
                                icon.className = this.getServiceIcon(serviceName);
                                parent.appendChild(icon);
                            }
                        },

                        // å–å¾—åœ–ç‰‡ URL - ä½¿ç”¨å¾Œå° API
                        getImageUrl(fileName) {
                            if (!fileName) return null;
                            return `${BACKEND_BASE_URL}/api/UploadFile/GetFile?fileName=${encodeURIComponent(fileName)}`;
                        }
                    }
                }).mount('#detailApp');

                // æ›è¼‰å®Œæˆå¾Œç¨å¾®å»¶é²é¡¯ç¤ºæ‡‰ç”¨ï¼Œç¢ºä¿æ¨£å¼è¼‰å…¥å®Œæˆ
                setTimeout(() => {
                    const app = document.getElementById('detailApp');
                    if (app) {
                        app.classList.add('vue-loaded');
                    }
                }, 100);

                console.log("âœ… æ©Ÿæ§‹è©³ç´° Vue mount æˆåŠŸï¼");
            }

            // ç«‹å³åŸ·è¡Œï¼ˆå¤–å±¤ post-load å·²ç¢ºä¿æ™‚æ©Ÿæ­£ç¢ºï¼‰
            initPageVue();
        })();

        // ===== åœ¨ä¸Šé¢æ”¾é é¢å°ˆå±¬çš„ JSï¼ˆåªæœƒåœ¨æ‰€æœ‰ç‰‡æ®µèˆ‡è³‡æºè¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œï¼‰ =====
    });
</script>

</html>