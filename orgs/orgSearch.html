<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>é•·ç…§æ©Ÿæ§‹æœå°‹ - æ¨‚é½¡æ©‹ VitalBridge</title>
    <meta name="description" content="æœå°‹é©åˆçš„é•·ç…§æ©Ÿæ§‹ï¼Œæä¾›å¾©å¥ä¸­å¿ƒã€æ—¥é–“ç…§è­·ä¸­å¿ƒã€è­·ç†ä¹‹å®¶ç­‰å¤šç¨®æœå‹™é¡å‹">
    <meta name="keywords" content="é•·ç…§æ©Ÿæ§‹,é¤Šè­·ä¸­å¿ƒ,è­·ç†ä¹‹å®¶,æ—¥é–“ç…§è­·,å¾©å¥ä¸­å¿ƒ,åœ¨å®…é¤Šè­·">

    <!-- Open Graph tags -->
    <meta property="og:title" content="é•·ç…§æ©Ÿæ§‹æœå°‹ - æ¨‚é½¡æ©‹ VitalBridge">
    <meta property="og:description" content="æœå°‹é©åˆçš„é•·ç…§æ©Ÿæ§‹ï¼Œæä¾›å¾©å¥ä¸­å¿ƒã€æ—¥é–“ç…§è­·ä¸­å¿ƒã€è­·ç†ä¹‹å®¶ç­‰å¤šç¨®æœå‹™é¡å‹">
    <meta property="og:type" content="website">

    <!-- Favicons -->
    <link href="/assets/img/favicon.png" rel="icon">
    <link href="/assets/img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="/assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
    <link href="/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

    <!-- Main CSS File -->
    <link href="/assets/css/main.css" rel="stylesheet">

    <!-- è‡ªå·±æƒ³æ”¹çš„æ¨£å¼æ”¾é€™é‚Š -->
    <style>
        /* æ©Ÿæ§‹æœå°‹é é¢è‡ªè¨‚æ¨£å¼ */
        .search-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 2rem 0;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .search-form {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .form-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 0.75rem;
        }

        .price-range-container {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 0.5rem;
        }

        .price-display {
            font-size: 1.1rem;
            font-weight: 600;
            color: #28a745;
        }

        .checkbox-group {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 0.5rem;
        }

        .form-check-input:checked {
            background-color: #007bff;
            border-color: #007bff;
        }

        .search-btn {
            background: linear-gradient(45deg, #007bff, #0056b3);
            border: none;
            padding: 0.75rem 2rem;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.3);
        }

        .org-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .org-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .org-image {
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
        }

        .card-img-container {
            height: 200px;
            border-radius: 10px;
            overflow: hidden;
        }

        .no-image-placeholder {
            height: 200px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            border: 2px dashed #dee2e6;
        }

        .card-img-container.no-image {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px dashed #dee2e6;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-img-container.no-image::after {
            content: "ğŸ“·\Aæš«ç„¡ç…§ç‰‡";
            white-space: pre;
            text-align: center;
            color: #6c757d;
            font-size: 2rem;
            line-height: 1.2;
        }

        .org-title {
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .org-location {
            color: #6c757d;
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
        }

        .org-price {
            color: #28a745;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .detail-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .detail-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .loading-spinner {
            color: #007bff;
        }

        .pagination {
            justify-content: center;
            margin-top: 2rem;
        }

        .page-link {
            border-radius: 8px;
            margin: 0 2px;
            border: none;
            background: #f8f9fa;
            color: #495057;
        }

        .page-link:hover {
            background: #007bff;
            color: white;
        }

        .page-item.active .page-link {
            background: #007bff;
            border-color: #007bff;
        }

        .breadcrumb {
            background: transparent;
            padding: 0;
            margin-bottom: 1rem;
        }

        .breadcrumb-item+.breadcrumb-item::before {
            content: ">";
            color: #6c757d;
        }

        .no-results {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        /* ç‰¹è‰²æœå‹™åœ–ç¤ºæ¨£å¼ */
        .feature-services {
            margin-top: 0.5rem;
        }

        .feature-services-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .feature-service-item {
            position: relative;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .feature-service-item:hover {
            transform: scale(1.1);
            border-color: #007bff;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }

        .feature-service-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .feature-service-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #6c757d;
        }

        /* ç‰¹è‰²æœå‹™åœ–ç¤ºæ¨£å¼ */
        .feature-services {
            margin-top: 0.75rem;
        }

        .feature-icons-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            max-width: 100%;
        }

        .feature-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .feature-icon img {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }

        .feature-icon:hover {
            border-color: #007bff;
            background: #e3f2fd;
            transform: scale(1.05);
        }

        .feature-icon.no-image {
            background: #f8f9fa;
            color: #6c757d;
            font-size: 0.75rem;
        }
    </style>

</head>

<body>
    <div class="headerpage"></div>

    <main class="main">
        <!-- Breadcrumb Navigation -->
        <section class="py-2">
            <div class="container">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/index.html">é¦–é </a></li>
                        <li class="breadcrumb-item active" aria-current="page">æ‰¾æ©Ÿæ§‹</li>
                    </ol>
                </nav>
            </div>
        </section>

        <!-- Search Section -->
        <section id="searchApp" class="section">
            <div class="container">
                <div class="search-container">
                    <div class="text-center mb-4">
                        <h1 class="fw-bold text-primary">é•·ç…§æ©Ÿæ§‹æœå°‹</h1>
                        <p class="lead text-muted">æ‰¾åˆ°æœ€é©åˆçš„é•·ç…§æ©Ÿæ§‹</p>
                    </div>

                    <div class="search-form">
                        <div class="row g-3">
                            <!-- é—œéµå­—æœå°‹ -->
                            <div class="col-md-6">
                                <label for="keyword" class="form-label">
                                    <i class="bi bi-search me-2"></i>æ©Ÿæ§‹åç¨±
                                </label>
                                <input type="text" class="form-control" id="keyword" v-model="searchForm.keyword"
                                    placeholder="è«‹è¼¸å…¥æ©Ÿæ§‹åç¨±é—œéµå­—" aria-label="æ©Ÿæ§‹åç¨±æœå°‹">
                            </div>

                            <!-- ç¸£å¸‚é¸æ“‡ -->
                            <div class="col-md-3">
                                <label for="city" class="form-label">
                                    <i class="bi bi-geo-alt me-2"></i>ç¸£å¸‚
                                </label>
                                <select class="form-select" id="city" v-model="searchForm.cityId" @change="onCityChange"
                                    aria-label="é¸æ“‡ç¸£å¸‚">
                                    <option value="0">å…¨éƒ¨ç¸£å¸‚</option>
                                    <option v-for="city in cities" :key="city.id" :value="city.id">
                                        {{ city.name }}
                                    </option>
                                </select>
                            </div>

                            <!-- é„‰é®å€é¸æ“‡ -->
                            <div class="col-md-3">
                                <label for="district" class="form-label">
                                    <i class="bi bi-map me-2"></i>é„‰é®å€
                                </label>
                                <select class="form-select" id="district" v-model="searchForm.districtId"
                                    :disabled="!searchForm.cityId || searchForm.cityId === 0" aria-label="é¸æ“‡é„‰é®å€">
                                    <option value="0">å…¨éƒ¨é„‰é®å€</option>
                                    <option v-for="district in districts" :key="district.id" :value="district.id">
                                        {{ district.name }}
                                    </option>
                                </select>
                            </div>

                            <!-- åƒ¹æ ¼ç¯„åœ -->
                            <div class="col-md-6">
                                <label for="priceRange" class="form-label">
                                    <i class="bi bi-currency-dollar me-2"></i>åƒ¹æ ¼ç¯„åœ
                                </label>
                                <div class="price-range-container">
                                    <input type="range" class="form-range" id="priceRange" v-model="searchForm.maxPrice"
                                        min="0" max="100000" step="1000" aria-label="åƒ¹æ ¼ç¯„åœé¸æ“‡">
                                    <div class="d-flex justify-content-between mt-2">
                                        <span class="price-display">NT$ {{ searchForm.maxPrice === 0 ? '0' : '1'
                                            }}</span>
                                        <span class="price-display">NT$ {{ formatPrice(searchForm.maxPrice) }}</span>
                                    </div>
                                    <div class="text-center mt-1">
                                        <small class="text-muted" v-if="searchForm.maxPrice === 0">
                                            åªæœå°‹å…è²»æ©Ÿæ§‹
                                        </small>
                                        <small class="text-muted" v-else>
                                            æ’é™¤å…è²»æ©Ÿæ§‹
                                        </small>
                                    </div>
                                </div>
                            </div>

                            <!-- æ©Ÿæ§‹é¡å‹ -->
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="bi bi-building me-2"></i>æ©Ÿæ§‹é¡å‹
                                </label>
                                <div class="checkbox-group">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="selectAll"
                                            v-model="selectAll" @change="toggleSelectAll" aria-label="é¸æ“‡å…¨éƒ¨æ©Ÿæ§‹ç‰¹è‰²">
                                        <label class="form-check-label fw-bold" for="selectAll">
                                            å…¨éƒ¨
                                        </label>
                                    </div>
                                    <div v-for="type in organizationTypes" :key="type.id" class="form-check">
                                        <input class="form-check-input" type="checkbox" :id="'type_' + type.id"
                                            :value="type.id" v-model="searchForm.organizationTypeIds"
                                            @change="onTypeChange" :aria-label="'é¸æ“‡' + type.name">
                                        <label class="form-check-label" :for="'type_' + type.id">
                                            {{ type.name }}
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- æœå°‹æŒ‰éˆ• -->
                            <div class="col-12 text-center">
                                <button type="button" class="btn btn-primary search-btn" @click="searchOrganizations"
                                    :disabled="loading" aria-label="æœå°‹æ©Ÿæ§‹">
                                    <span v-if="loading" class="spinner-border spinner-border-sm me-2" role="status"
                                        aria-hidden="true"></span>
                                    <i v-else class="bi bi-search me-2"></i>
                                    {{ loading ? 'æœå°‹ä¸­...' : 'æœå°‹æ©Ÿæ§‹' }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Error Message -->
                <div v-if="errorMessage" class="error-message" role="alert">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    {{ errorMessage }}
                </div>

                <!-- Search Results -->
                <div v-if="searchResults.length > 0">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3>æœå°‹çµæœ ({{ totalResults }} ç­†)</h3>
                        <small class="text-muted">ç¬¬ {{ currentPage }} é ï¼Œå…± {{ totalPages }} é </small>
                    </div>

                    <div class="row">
                        <div v-for="org in searchResults" :key="org.id" class="col-12">
                            <div class="card org-card h-100">
                                <div class="row g-0 h-100">
                                    <div class="col-md-3">
                                        <div class="card-img-container position-relative">
                                            <img v-if="getImageUrl(org.photoUrl)" :src="getImageUrl(org.photoUrl)"
                                                :data-filename="org.photoUrl" :alt="org.name + 'æ©Ÿæ§‹ç…§ç‰‡'"
                                                class="img-fluid org-image w-100 h-100" loading="lazy"
                                                @error="handleImageError($event)">
                                            <div v-else
                                                class="no-image-placeholder d-flex align-items-center justify-content-center h-100">
                                                <div class="text-center text-muted">
                                                    <i class="bi bi-building fs-1 mb-2"></i>
                                                    <div class="small">æš«ç„¡ç…§ç‰‡</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-9">
                                        <div class="card-body d-flex flex-column h-100">
                                            <div class="row">
                                                <div class="col-md-8">
                                                    <h5 class="card-title org-title">{{ org.name }}</h5>
                                                    <p class="org-location">
                                                        <i class="bi bi-geo-alt me-1"></i>
                                                        {{ org.cityName }}{{ org.districtName }}
                                                    </p>
                                                    <p class="card-text text-muted small">{{ org.address }}</p>

                                                    <!-- ç‰¹è‰²æœå‹™åœ–ç¤º -->
                                                    <div v-if="org.featureServiceNames && org.featureServiceNames.length > 0"
                                                        class="feature-services">
                                                        <small class="text-muted d-block mb-1">ç‰¹è‰²æœå‹™ï¼š</small>
                                                        <div class="feature-services-grid">
                                                            <div v-for="(serviceName, index) in org.featureServiceNames.slice(0, 8)"
                                                                :key="index" class="feature-service-item"
                                                                :title="serviceName">
                                                                <img v-if="getFeatureServiceImage(serviceName)"
                                                                    :src="getFeatureServiceImage(serviceName)"
                                                                    :alt="serviceName" class="feature-service-img"
                                                                    loading="lazy"
                                                                    @error="handleFeatureServiceImageError($event)">
                                                                <div v-else class="feature-service-placeholder">
                                                                    <i class="bi bi-star"></i>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 text-end">
                                                    <div class="mb-2">
                                                        <small class="text-muted">åºŠä½æ•¸: {{ org.bedCount }}</small>
                                                    </div>
                                                    <div class="mb-3">
                                                        <span class="org-price">NT$ {{ formatPrice(org.minMonthlyPrice)
                                                            }} èµ·</span>
                                                    </div>
                                                    <button type="button" class="btn btn-success detail-btn"
                                                        @click="viewDetail(org.id)"
                                                        :aria-label="'æŸ¥çœ‹' + org.name + 'è©³ç´°è³‡æ–™'">
                                                        è©³ç´°è³‡æ–™
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <nav aria-label="æœå°‹çµæœåˆ†é ">
                        <ul class="pagination">
                            <li class="page-item" :class="{ disabled: currentPage === 1 }">
                                <button class="page-link" @click="goToPage(currentPage - 1)"
                                    :disabled="currentPage === 1" aria-label="ä¸Šä¸€é ">
                                    <i class="bi bi-chevron-left"></i>
                                </button>
                            </li>

                            <li v-for="page in visiblePages" :key="page" class="page-item"
                                :class="{ active: currentPage === page }">
                                <button class="page-link" @click="goToPage(page)" :aria-label="'ç¬¬' + page + 'é '">
                                    {{ page }}
                                </button>
                            </li>

                            <li class="page-item" :class="{ disabled: currentPage === totalPages }">
                                <button class="page-link" @click="goToPage(currentPage + 1)"
                                    :disabled="currentPage === totalPages" aria-label="ä¸‹ä¸€é ">
                                    <i class="bi bi-chevron-right"></i>
                                </button>
                            </li>
                        </ul>
                    </nav>
                </div>

                <!-- No Results -->
                <div v-else-if="!loading && hasSearched" class="no-results">
                    <i class="bi bi-search display-1 text-muted"></i>
                    <h3 class="mt-3">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„æ©Ÿæ§‹</h3>
                    <p>è«‹èª¿æ•´æœå°‹æ¢ä»¶å¾Œå†è©¦ä¸€æ¬¡</p>
                </div>

                <!-- Initial State -->
                <div v-else-if="!loading && !hasSearched" class="no-results">
                    <i class="bi bi-building display-1 text-muted"></i>
                    <h3 class="mt-3">è«‹è¨­å®šæœå°‹æ¢ä»¶</h3>
                    <p>è¼¸å…¥é—œéµå­—æˆ–é¸æ“‡ç¯©é¸æ¢ä»¶é–‹å§‹æœå°‹</p>
                </div>
            </div>
        </section>
    </main>

    <div class="footerpage"></div>

    <!-- Scroll Top -->
    <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>
    <!-- Preloader -->
    <div id="preloader"></div>

    <!-- Vendor JS Files -->
    <script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/vendor/php-email-form/validate.js"></script>
    <script src="/assets/vendor/aos/aos.js"></script>
    <script src="/assets/vendor/waypoints/noframework.waypoints.js"></script>
    <script src="/assets/vendor/purecounter/purecounter_vanilla.js"></script>
    <script src="/assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="/assets/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="/assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>

    <!-- å…¶ä»–è¦è£çš„jsæ”¾åœ¨é€™ä¹‹å‰ -->
    <script src="/assets/js/fragment-loader.js" defer></script>

</body>

<!-- Simple page hook: åœ¨ä¸‹é¢å€å¡Šç›´æ¥å¯«é é¢å°ˆå±¬çš„ JSï¼ˆæ­¤å‡½å¼æœƒç­‰åˆ° fragment-loader ç™¼å‡º app:ready ä¸” window.load å®Œæˆå¾ŒåŸ·è¡Œï¼‰ -->
<script>
    (function onFullyReady(run) {
        function once(ev) { return new Promise(res => { function h(e) { window.removeEventListener(ev, h); res(e); } window.addEventListener(ev, h); }); }
        function waitAppReady() { if (window.appReadyAt !== undefined) return Promise.resolve(); return once('app:ready'); }
        function waitWindowLoad() { if (document.readyState === 'complete') return Promise.resolve(); return once('load'); }
        Promise.all([waitAppReady(), waitWindowLoad()]).then(run).catch(function (e) { console.error('post-load hook error', e); });
    })(function () {
        // ===== åœ¨ä¸‹é¢æ”¾é é¢å°ˆå±¬çš„ JSï¼ˆåªæœƒåœ¨æ‰€æœ‰ç‰‡æ®µèˆ‡è³‡æºè¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œï¼‰ =====

        //Vueçš„éƒ¨åˆ†å¯«é€™é‚Š
        (function mountVue() {
            // æŠŠé é¢å°ˆå±¬çš„ Vue ç¨‹å¼å¯«åœ¨é€™å€‹å‡½å¼è£¡
            function initPageVue() {
                if (typeof Vue === 'undefined') return; // è‹¥æœªè¼‰å…¥ Vue å‰‡è·³é
                if (typeof axios === 'undefined') return; // è‹¥æœªè¼‰å…¥ axios å‰‡è·³é

                const { createApp } = Vue;

                // API é…ç½®å¸¸æ•¸
                const API_BASE_URL = 'https://localhost:7104';
                const BACKEND_BASE_URL = 'https://localhost:7184'; // å¾Œå° API åŸºç¤ URL

                // æ©Ÿæ§‹ç›¸é—œ API æœå‹™
                const orgApi = {
                    getCities: () => apiClient.get('/api/Organizations/cities'),
                    getOrganizationTypes: () => apiClient.get('/api/Organizations/organization-types'),
                    getDistricts: (cityId) => apiClient.get(`/api/Organizations/cities/${cityId}/districts`),
                    searchOrganizations: (data) => apiClient.post('/api/Organizations/search', data),
                    getFeatureServices: () => apiClient.get('/api/Organizations/feature-services') // æ–°å¢ï¼šå–å¾—æ‰€æœ‰ç‰¹è‰²æœå‹™
                };

                // åœ–ç‰‡æœå‹™ - ä½¿ç”¨å¾Œå° API ç›´æ¥å–å¾—åœ–ç‰‡ï¼ˆèˆ‡ LoadPlate.js ç›¸åŒæ–¹å¼ï¼‰
                const getImageUrl = (fileName) => {
                    if (!fileName) return null;
                    const url = `${BACKEND_BASE_URL}/api/UploadFile/GetFile?fileName=${encodeURIComponent(fileName)}`;
                    console.log('ç”¢ç”Ÿåœ–ç‰‡URL:', url); // é™¤éŒ¯ç”¨
                    return url;
                };

                // Axios é…ç½®
                const apiClient = axios.create({
                    baseURL: API_BASE_URL,
                    timeout: 30000,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                // Axios éŒ¯èª¤æ””æˆªå™¨
                apiClient.interceptors.response.use(
                    response => response,
                    error => {
                        console.error('API Error:', error);
                        let errorMessage = 'ç¶²è·¯é€£ç·šç•°å¸¸ï¼Œè«‹ç¨å¾Œå†è©¦';

                        if (error.response) {
                            // ä¼ºæœå™¨å›æ‡‰éŒ¯èª¤
                            errorMessage = `ä¼ºæœå™¨éŒ¯èª¤ (${error.response.status})`;
                        } else if (error.request) {
                            // è«‹æ±‚å·²ç™¼é€ä½†ç„¡å›æ‡‰
                            errorMessage = 'ç„¡æ³•é€£ç·šåˆ°ä¼ºæœå™¨ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š';
                        }

                        return Promise.reject({ message: errorMessage, originalError: error });
                    }
                );

                createApp({
                    data() {
                        return {
                            // æœå°‹è¡¨å–®
                            searchForm: {
                                keyword: '',
                                cityId: 0,
                                districtId: 0,
                                minPrice: 0,
                                maxPrice: 100000,
                                organizationTypeIds: [],
                                featureServiceIds: []
                            },

                            // ä¸‹æ‹‰é¸å–®è³‡æ–™
                            cities: [],
                            districts: [],
                            organizationTypes: [],

                            // æœå°‹çµæœ
                            searchResults: [],
                            totalResults: 0,
                            currentPage: 1,
                            totalPages: 1,
                            pageSize: 12,

                            // ç‰¹è‰²æœå‹™è³‡æ–™å¿«å–
                            featureServicesCache: new Map(), // å¿«å–ç‰¹è‰²æœå‹™åç¨±å°æ‡‰çš„åœ–ç‰‡

                            // ç‹€æ…‹ç®¡ç†
                            loading: false,
                            hasSearched: false,
                            errorMessage: '',
                            selectAll: false
                        };
                    },

                    computed: {
                        visiblePages() {
                            const pages = [];
                            const start = Math.max(1, this.currentPage - 2);
                            const end = Math.min(this.totalPages, this.currentPage + 2);

                            for (let i = start; i <= end; i++) {
                                pages.push(i);
                            }
                            return pages;
                        }
                    },

                    async mounted() {
                        await this.loadInitialData();
                    },

                    methods: {
                        // è¼‰å…¥åˆå§‹è³‡æ–™
                        async loadInitialData() {
                            try {
                                await Promise.all([
                                    this.loadCities(),
                                    this.loadOrganizationTypes(),
                                    this.loadFeatureServices() // æ–°å¢ï¼šè¼‰å…¥ç‰¹è‰²æœå‹™è³‡æ–™
                                ]);
                            } catch (error) {
                                this.errorMessage = 'è¼‰å…¥åŸºæœ¬è³‡æ–™å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢';
                            }
                        },

                        // è¼‰å…¥åŸå¸‚åˆ—è¡¨
                        async loadCities() {
                            try {
                                console.log('é–‹å§‹è¼‰å…¥åŸå¸‚åˆ—è¡¨...');
                                const response = await orgApi.getCities();
                                console.log('åŸå¸‚åˆ—è¡¨è¼‰å…¥æˆåŠŸ:', response.data);
                                this.cities = response.data;
                            } catch (error) {
                                console.error('è¼‰å…¥åŸå¸‚åˆ—è¡¨å¤±æ•—:', error);
                                console.error('éŒ¯èª¤è©³æƒ…:', error.response?.data);
                                this.errorMessage = error.message;
                            }
                        },

                        // è¼‰å…¥æ©Ÿæ§‹é¡å‹
                        async loadOrganizationTypes() {
                            try {
                                console.log('é–‹å§‹è¼‰å…¥æ©Ÿæ§‹é¡å‹...');
                                const response = await orgApi.getOrganizationTypes();
                                console.log('æ©Ÿæ§‹é¡å‹è¼‰å…¥æˆåŠŸ:', response.data);
                                this.organizationTypes = response.data;
                            } catch (error) {
                                console.error('è¼‰å…¥æ©Ÿæ§‹é¡å‹å¤±æ•—:', error);
                                console.error('éŒ¯èª¤è©³æƒ…:', error.response?.data);
                                this.errorMessage = error.message;
                            }
                        },

                        // è¼‰å…¥ç‰¹è‰²æœå‹™è³‡æ–™
                        async loadFeatureServices() {
                            try {
                                console.log('é–‹å§‹è¼‰å…¥ç‰¹è‰²æœå‹™è³‡æ–™...');
                                const response = await orgApi.getFeatureServices();
                                console.log('ç‰¹è‰²æœå‹™è¼‰å…¥æˆåŠŸ:', response.data);

                                // å»ºç«‹åç¨±å°æ‡‰åœ–ç‰‡çš„å¿«å–
                                response.data.forEach(service => {
                                    this.featureServicesCache.set(service.name, service.imageUrl);
                                });
                                console.log('ç‰¹è‰²æœå‹™å¿«å–å»ºç«‹å®Œæˆ:', this.featureServicesCache);
                            } catch (error) {
                                console.error('è¼‰å…¥ç‰¹è‰²æœå‹™å¤±æ•—:', error);
                                console.error('éŒ¯èª¤è©³æƒ…:', error.response?.data);
                                // ä¸è¨­å®šéŒ¯èª¤è¨Šæ¯ï¼Œå› ç‚ºç‰¹è‰²æœå‹™ä¸æ˜¯å¿…é ˆçš„
                            }
                        },

                        // åŸå¸‚è®Šæ›´æ™‚è¼‰å…¥å€åŸŸ
                        async onCityChange() {
                            this.searchForm.districtId = 0;
                            this.districts = [];

                            if (this.searchForm.cityId && this.searchForm.cityId !== 0) {
                                try {
                                    const response = await orgApi.getDistricts(this.searchForm.cityId);
                                    this.districts = response.data;
                                } catch (error) {
                                    console.error('è¼‰å…¥å€åŸŸåˆ—è¡¨å¤±æ•—:', error);
                                    this.errorMessage = error.message;
                                }
                            }
                        },

                        // å…¨é¸é‚è¼¯
                        toggleSelectAll() {
                            if (this.selectAll) {
                                this.searchForm.organizationTypeIds = this.organizationTypes.map(type => type.id);
                            } else {
                                this.searchForm.organizationTypeIds = [];
                            }
                        },

                        // æ©Ÿæ§‹é¡å‹è®Šæ›´
                        onTypeChange() {
                            const allSelected = this.organizationTypes.every(type =>
                                this.searchForm.organizationTypeIds.includes(type.id)
                            );
                            this.selectAll = allSelected;
                        },

                        // æœå°‹æ©Ÿæ§‹
                        async searchOrganizations(page = 1) {
                            this.loading = true;
                            this.errorMessage = '';
                            this.currentPage = page;

                            try {
                                // æ ¹æ“šå¾Œç«¯APIæœŸå¾…çš„æ ¼å¼æ§‹å»ºè«‹æ±‚
                                const searchDto = {
                                    keyword: this.searchForm.keyword || '',
                                    cityId: this.searchForm.cityId ? parseInt(this.searchForm.cityId) : 0,
                                    districtId: this.searchForm.districtId ? parseInt(this.searchForm.districtId) : 0,
                                    // åƒ¹æ ¼ç¯©é¸é‚è¼¯ï¼šç•¶åƒ¹æ ¼ç¯„åœç‚º 0 æ™‚ï¼Œåªæœå°‹åƒ¹æ ¼ç‚º 0 çš„æ©Ÿæ§‹ï¼›å¦å‰‡æ’é™¤åƒ¹æ ¼ç‚º 0 çš„æ©Ÿæ§‹
                                    minPrice: this.searchForm.maxPrice === 0 ? 0 : 1,
                                    maxPrice: this.searchForm.maxPrice || 100000,
                                    organizationTypeIds: this.searchForm.organizationTypeIds || [],
                                    featureServiceIds: this.searchForm.featureServiceIds || []
                                };

                                const requestData = {
                                    searchDto: searchDto,
                                    page: parseInt(page) || 1,
                                    pageSize: parseInt(this.pageSize) || 10
                                };

                                console.log('æœå°‹è«‹æ±‚è³‡æ–™:', requestData);

                                const response = await orgApi.searchOrganizations(requestData);
                                console.log('æœå°‹å›æ‡‰:', response.data);
                                console.log('æ©Ÿæ§‹åˆ—è¡¨:', response.data.items);

                                // Debug: æª¢æŸ¥ç¬¬ä¸€å€‹æ©Ÿæ§‹çš„åœ–ç‰‡æª”å
                                if (response.data.items && response.data.items.length > 0) {
                                    console.log('ç¬¬ä¸€å€‹æ©Ÿæ§‹æ•¸æ“š:', response.data.items[0]);
                                    console.log('åœ–ç‰‡æª”åæ¬„ä½:', {
                                        photoUrl: response.data.items[0].photoUrl,
                                        imageUrl: response.data.items[0].imageUrl,
                                        photo: response.data.items[0].photo,
                                        image: response.data.items[0].image,
                                        fileName: response.data.items[0].fileName
                                    });

                                    // Debug: æª¢æŸ¥ç‰¹è‰²æœå‹™è³‡æ–™
                                    console.log('ç‰¹è‰²æœå‹™åç¨±:', response.data.items[0].featureServiceNames);
                                    if (response.data.items[0].featureServiceNames && response.data.items[0].featureServiceNames.length > 0) {
                                        console.log('ç¬¬ä¸€å€‹ç‰¹è‰²æœå‹™åç¨±:', response.data.items[0].featureServiceNames[0]);
                                        console.log('ç‰¹è‰²æœå‹™åœ–ç‰‡æ¸¬è©¦:', this.getFeatureServiceImage(response.data.items[0].featureServiceNames[0]));
                                    } else {
                                        console.log('æ­¤æ©Ÿæ§‹æ²’æœ‰ç‰¹è‰²æœå‹™åç¨±');
                                    }
                                }

                                this.searchResults = response.data.items || [];
                                this.totalResults = response.data.totalCount || 0;
                                this.currentPage = response.data.pageNumber || 1;
                                this.totalPages = response.data.totalPages || 1;
                                this.hasSearched = true;

                                // æ¸…é™¤éŒ¯èª¤è¨Šæ¯
                                this.errorMessage = '';

                            } catch (error) {
                                console.error('æœå°‹æ©Ÿæ§‹å¤±æ•—:', error);
                                console.error('éŒ¯èª¤å›æ‡‰:', error.response?.data);
                                console.error('éŒ¯èª¤ç‹€æ…‹:', error.response?.status);
                                console.error('éŒ¯èª¤æ¨™é ­:', error.response?.headers);
                                console.error('å®Œæ•´éŒ¯èª¤:', JSON.stringify(error, null, 2));

                                // æ ¹æ“šå¾Œç«¯å›å‚³çš„éŒ¯èª¤æ ¼å¼æ”¹å–„éŒ¯èª¤è¨Šæ¯
                                if (error.response?.status === 400) {
                                    const errorData = error.response.data;
                                    if (errorData && errorData.errors) {
                                        // é¡¯ç¤ºè©³ç´°çš„é©—è­‰éŒ¯èª¤
                                        const errorMessages = [];
                                        for (const [field, messages] of Object.entries(errorData.errors)) {
                                            errorMessages.push(...messages);
                                        }
                                        this.errorMessage = `è«‹æ±‚åƒæ•¸éŒ¯èª¤ï¼š${errorMessages.join('; ')}`;
                                    } else {
                                        this.errorMessage = 'æœå°‹åƒæ•¸æœ‰èª¤ï¼Œè«‹æª¢æŸ¥è¼¸å…¥æ¢ä»¶';
                                    }
                                } else if (error.response?.status === 500) {
                                    this.errorMessage = 'ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦';
                                } else if (error.code === 'NETWORK_ERROR' || error.message.includes('Network Error')) {
                                    this.errorMessage = 'ç¶²è·¯é€£ç·šéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ç‹€æ…‹';
                                } else {
                                    this.errorMessage = `æœå°‹å¤±æ•—ï¼š${error.message || 'æœªçŸ¥éŒ¯èª¤'}`;
                                }

                                this.searchResults = [];
                                this.totalResults = 0;
                            } finally {
                                this.loading = false;
                            }
                        },

                        // åˆ†é å°èˆª
                        goToPage(page) {
                            if (page >= 1 && page <= this.totalPages && page !== this.currentPage) {
                                this.searchOrganizations(page);
                                // æ»¾å‹•åˆ°é ‚éƒ¨
                                window.scrollTo({ top: 0, behavior: 'smooth' });
                            }
                        },

                        // æŸ¥çœ‹è©³ç´°è³‡æ–™
                        viewDetail(organizationId) {
                            window.location.href = `/orgs/orgDetail.html?id=${organizationId}`;
                        },

                        // æ ¼å¼åŒ–åƒ¹æ ¼
                        formatPrice(price) {
                            return new Intl.NumberFormat('zh-TW').format(price);
                        },

                        // å–å¾—ç‰¹è‰²æœå‹™åœ–ç‰‡
                        getFeatureServiceImage(serviceName) {
                            console.log('æŸ¥è©¢ç‰¹è‰²æœå‹™åœ–ç‰‡ - æœå‹™åç¨±:', serviceName);
                            const imageUrl = this.featureServicesCache.get(serviceName);
                            console.log('å¾å¿«å–å–å¾—çš„åœ–ç‰‡æª”å:', imageUrl);

                            if (imageUrl) {
                                const fullUrl = this.getImageUrl(imageUrl);
                                console.log('ç”¢ç”Ÿçš„å®Œæ•´åœ–ç‰‡URL:', fullUrl);
                                return fullUrl;
                            }

                            console.log('ç‰¹è‰²æœå‹™ç„¡åœ–ç‰‡ï¼Œå›å‚³ null');
                            return null;
                        },

                        // å–å¾—åœ–ç‰‡ URL - ä½¿ç”¨å¾Œå° APIï¼ˆèˆ‡ LoadPlate.js ç›¸åŒæ–¹å¼ï¼‰
                        getImageUrl(fileName) {
                            console.log('å–å¾—åœ–ç‰‡URL - æª”å:', fileName);
                            if (!fileName) {
                                console.log('ç„¡åœ–ç‰‡æª”åï¼Œå›å‚³ null');
                                return null;
                            }

                            // ä½¿ç”¨å¾Œå° API ç›´æ¥å–å¾—åœ–ç‰‡ï¼Œèˆ‡ LoadPlate.js ä¿æŒä¸€è‡´
                            const imageUrl = `${BACKEND_BASE_URL}/api/UploadFile/GetFile?fileName=${encodeURIComponent(fileName)}`;
                            console.log('ç”¢ç”Ÿçš„åœ–ç‰‡URL (å¾Œå°API):', imageUrl);
                            return imageUrl;
                        },

                        // åœ–ç‰‡è¼‰å…¥éŒ¯èª¤è™•ç† - ä½¿ç”¨å¾Œå° API
                        handleImageError(event) {
                            const img = event.target;
                            const fileName = img.getAttribute('data-filename');
                            console.log('åœ–ç‰‡è¼‰å…¥å¤±æ•— - å¾Œå°API URL:', img.src);
                            console.log('åŸå§‹æª”å:', fileName);

                            // é¿å…ç„¡é™å¾ªç’°è¼‰å…¥éŒ¯èª¤
                            img.onerror = null;

                            // ç›´æ¥é¡¯ç¤ºé è¨­åœ–ç‰‡æ¨£å¼
                            console.log('åœ–ç‰‡ä¸å­˜åœ¨ï¼Œé¡¯ç¤ºé è¨­æ¨£å¼');
                            this.showDefaultImage(img);
                        },

                        // é¡¯ç¤ºé è¨­åœ–ç‰‡æ¨£å¼
                        showDefaultImage(img) {
                            // éš±è—åœ–ç‰‡ï¼Œé¡¯ç¤ºé è¨­æ¨£å¼
                            img.style.display = 'none';
                            // é¡¯ç¤ºçˆ¶å®¹å™¨çš„é è¨­èƒŒæ™¯
                            const parent = img.closest('.card-img-container');
                            if (parent) {
                                parent.classList.add('no-image');
                            }
                            // é¿å…ç„¡é™å¾ªç’°è¼‰å…¥éŒ¯èª¤
                            img.onerror = null;
                        },

                        // ç‰¹è‰²æœå‹™åœ–ç‰‡è¼‰å…¥éŒ¯èª¤è™•ç†
                        handleFeatureServiceImageError(event) {
                            const img = event.target;
                            console.log('ç‰¹è‰²æœå‹™åœ–ç‰‡è¼‰å…¥å¤±æ•—:', img.src);

                            // é¿å…ç„¡é™å¾ªç’°è¼‰å…¥éŒ¯èª¤
                            img.onerror = null;

                            // éš±è—åœ–ç‰‡ï¼Œé¡¯ç¤ºé è¨­åœ–ç¤º
                            img.style.display = 'none';
                            const parent = img.closest('.feature-service-item');
                            if (parent && !parent.querySelector('.feature-service-placeholder')) {
                                const placeholder = document.createElement('div');
                                placeholder.className = 'feature-service-placeholder';
                                placeholder.innerHTML = '<i class="bi bi-star"></i>';
                                parent.appendChild(placeholder);
                            }
                        }
                    }
                }).mount('#searchApp');

                console.log("âœ… æ©Ÿæ§‹æœå°‹ Vue mount æˆåŠŸï¼");
            }

            // ç«‹å³åŸ·è¡Œï¼ˆå¤–å±¤ post-load å·²ç¢ºä¿æ™‚æ©Ÿæ­£ç¢ºï¼‰
            initPageVue();
        })();

        // ===== åœ¨ä¸Šé¢æ”¾é é¢å°ˆå±¬çš„ JSï¼ˆåªæœƒåœ¨æ‰€æœ‰ç‰‡æ®µèˆ‡è³‡æºè¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œï¼‰ =====
    });
</script>

</html>