<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>å•†å“è©³æƒ… - æ¨‚é½¡å•†åŸ</title>
  <meta name="description" content="å°ˆç‚ºéŠ€é«®æ—è¨­è¨ˆçš„å¥åº·å•†åŸ - å•†å“è©³æƒ…">

  <!-- Favicons -->
  <link href="/assets/img/favicon.png" rel="icon">
  <link href="/assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="/assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="/assets/css/main.css" rel="stylesheet">

  <!-- è‡ªå·±æƒ³æ”¹çš„æ¨£å¼æ”¾é€™é‚Š -->
  <style>
    /* ç¸®åœ–ç›¸é—œæ¨£å¼ */
    .thumbnail-image {
      cursor: pointer;
      transition: all 0.3s ease;
      aspect-ratio: 1 / 1;
      /* 1:1 æ¯”ä¾‹ */
      object-fit: contain;
    }

    .thumbnail-image:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    /* ä¸»åœ–å®¹å™¨ */
    .main-image-container {
      position: relative;
      overflow: hidden;
      border-radius: 8px;
      aspect-ratio: 1 / 1;
      /* 1:1 æ¯”ä¾‹ */
      background-color: #f8f9fa;
      /* å¯é¸ï¼šåŠ å€‹æ·¡ç°è‰²èƒŒæ™¯ï¼Œè®“ç•™ç™½å€åŸŸæ›´æ˜é¡¯ */
    }

    .main-image-container img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    /* éŠ€é«®æ—å‹å–„çš„æŒ‰éˆ•æ¨£å¼ */
    .btn-lg {
      font-size: 1.1rem;
      padding: 12px 24px;
    }

    /* æ•¸é‡é¸æ“‡å™¨æ¨£å¼ */
    .input-group input[type="number"] {
      font-size: 1.1rem;
      font-weight: 500;
    }

    /* ğŸ”¥ æ–°å¢ï¼šä¿®æ­£é ç±¤é¡¯ç¤ºå•é¡Œ */
    .tab-pane {
      min-height: 200px;
      display: block !important;
      opacity: 1;
    }

    /* ç¢ºä¿é ç±¤å…§å®¹æ–‡å­—å¯è¦‹ */
    .card-body {
      color: #333;
      line-height: 1.6;
    }

    /* ç¢ºä¿æè¿°å…§å®¹æ­£ç¢ºé¡¯ç¤º */
    .product-description,
    .delivery-info,
    .shopping-notice {
      color: #333;
      line-height: 1.8;
    }

    /* æ ¼å¼åŒ–å¾Œçš„æ›è¡Œå…§å®¹æ¨£å¼ */
    .product-description p,
    .delivery-info p,
    .shopping-notice p {
      margin-bottom: 1rem;
    }

    /* é ç±¤æŒ‰éˆ•æ¨£å¼å„ªåŒ– */
    .nav-tabs .nav-link {
      color: #666;
      font-weight: 500;
    }

    .nav-tabs .nav-link.active {
      color: #0d6efd;
      font-weight: 600;
    }

    /* ğŸ”¥ æ–°å¢ï¼šå•†å“è²¨è™Ÿæ¨£å¼ */
    .product-item-number {
      font-size: 0.9rem;
      color: #aeb2b6;
      display: inline-flex;
      align-items: center;
    }

    .product-item-number .fw-semibold {
      color: #aeb2b6;

      letter-spacing: 0.5px;
    }

    /*åŠ å…¥è³¼ç‰©è»ŠæŒ‰éˆ•*/

    .btn-cart {
      background-color: #198754;
      border-color: #198754;
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s ease;
      flex: 1;
      margin-right: 8px;
    }

    .btn-cart:hover {
      background-color: #157347;
      border-color: #146c43;
      color: white;
      transform: translateY(-2px);
    }





    /* éŸ¿æ‡‰å¼èª¿æ•´ */
    @media (max-width: 768px) {
      .thumbnail-container .col-2 {
        flex: 0 0 auto;
        width: 16.666667%;
      }
    }
  </style>

</head>

<!-- <body class="index-page"> -->

<body>
  <div class="headerpage"></div> <!-- ä¸»å°è¦½ -->
  <div class="shop-headerpage"></div> <!-- è³¼ç‰©å°è¦½ -->


  <!-- ä¿®æ­£ main å€å¡Šå…§çš„çµæ§‹ -->

  <main class="main">
    <div id="product-detail-app">
      <!-- æˆåŠŸè¼‰å…¥æ™‚é¡¯ç¤ºå•†å“è©³æƒ… -->
      <div class="container mt-4" v-if="!loading && !error && product && Object.keys(product).length > 0">
        <!-- éºµåŒ…å±‘å°èˆª -->
        <nav aria-label="breadcrumb" class="mb-4">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="/VitalBridge/ECshop/index.html">é¦–é </a>
            </li>
            <li class="breadcrumb-item">
              <a href="/VitalBridge/ECshop/category.html">å…¨éƒ¨å•†å“</a>
            </li>

            <!-- å‹•æ…‹é¡¯ç¤ºé¡åˆ¥è·¯å¾‘ -->
            <li v-for="(category, index) in categoryPath" v-if="categoryPath && categoryPath.length > 0"
              :key="category.id" class="breadcrumb-item">

              <!-- é™¤äº†æœ€å¾Œä¸€å€‹ï¼Œå…¶ä»–éƒ½è¦æœ‰é€£çµ -->
              <a v-if="index < categoryPath.length - 1" :href="getCategoryUrl(category)">
                {{ category.name }}
              </a>
              <!-- æœ€å¾Œä¸€å€‹é¡åˆ¥æœ‰é€£çµï¼ˆå› ç‚ºé‚„ä¸æ˜¯å•†å“é é¢ï¼‰ -->
              <a v-else :href="getCategoryUrl(category)">
                {{ category.name }}
              </a>
            </li>

            <!-- å¦‚æœæ²’æœ‰é¡åˆ¥è·¯å¾‘ï¼Œé¡¯ç¤ºåŸºæœ¬é¡åˆ¥ -->
            <li
              v-if="(!categoryPath || categoryPath.length === 0) && product.categories && product.categories.length > 0"
              class="breadcrumb-item">
              <a :href="getCategoryUrl(product.categories[0])">
                {{ product.categories[0].name }}
              </a>
            </li>

            <!-- å•†å“åç¨±ï¼ˆæœ€çµ‚é …ç›®ï¼Œç„¡é€£çµï¼‰ -->
            <li class="breadcrumb-item active" aria-current="page">
              {{ product.name || 'å•†å“è©³æƒ…' }}
            </li>
          </ol>
        </nav>




        <!-- å•†å“è©³æƒ…ä¸»è¦å€åŸŸ -->
        <div class="row">
          <!-- å·¦å´ï¼šå•†å“åœ–ç‰‡å€ -->
          <div class="col-lg-6 col-md-6 mb-4">
            <!-- ä¸»åœ– -->
            <div class="main-image-container mb-3">
              <img v-bind:src="mainImage" alt="å•†å“ä¸»åœ–" class="img-fluid border rounded shadow-sm"
                v-on:error="handleImageError">
            </div>

            <!-- ç¸®åœ–åˆ—è¡¨ -->
            <div class="thumbnail-container" v-if="product.images && product.images.length > 0">
              <div class="row">
                <div v-for="(imageObj, index) in product.images" :key="index" class="col-2 mb-2">
                  <img v-bind:src="getImageUrl(imageObj.fileName)" v-bind:alt="`å•†å“åœ–ç‰‡ ${index + 1}`"
                    class="img-fluid border rounded cursor-pointer thumbnail-image"
                    v-bind:class="{ 'border-primary border-3': mainImage === getImageUrl(imageObj.fileName) }"
                    v-on:click="changeMainImage(getImageUrl(imageObj.fileName))" v-on:error="handleImageError"
                    style="height: 60px; object-fit:  contain;">
                </div>
              </div>
            </div>
          </div>

          <!-- å³å´ï¼šå•†å“è³‡è¨Šå€ -->
          <div class="col-lg-6 col-md-6">
            <!-- å•†å“åç¨± -->
            <h1 class="h3 mb-3 fw-bold">{{ product.name }}</h1>

            <!-- ğŸ”¥ æ–°å¢ï¼šå•†å“è²¨è™Ÿ -->
            <div v-if="product.itemNumber" class="mb-3">
              <span class="product-item-number">
                <i class="bi bi-tag-fill text-secondary me-1"></i>
                <span class="text-secondary">è²¨è™Ÿï¼š</span>
                <span class="fw-semibold">{{ product.itemNumber }}</span>
              </span>
            </div>

            <!-- å•†å“é‡é»ç‰¹è‰² -->
            <div v-if="product.keypoint" class="mb-3">
              <p class="text-muted fs-6 mb-0">{{ product.keypoint }}</p>
            </div>

            <!-- åƒ¹æ ¼ -->
            <div class="mb-4">
              <span class="h2 text-danger fw-bold">NT$ {{ formatPrice(product.price) }}</span>
              <span v-if="product.originalPrice && product.originalPrice > product.price"
                class="text-muted text-decoration-line-through ms-2">
                NT$ {{ formatPrice(product.originalPrice) }}
              </span>
            </div>

            <!-- æ•¸é‡é¸æ“‡å™¨ -->
            <div class="mb-4 quantity-selector">
              <!-- <label class="form-label fw-semibold">æ•¸é‡ï¼š</label>
              <div class="input-group" style="width: 150px;">
                <button class="btn btn-outline-secondary" type="button" v-on:click="decreaseQuantity">
                  <i class="bi bi-dash"></i>
                </button>
                <input type="number" class="form-control text-center" v-model.number="quantity" min="1" max="99">
                <button class="btn btn-outline-secondary" type="button" v-on:click="increaseQuantity">
                  <i class="bi bi-plus"></i>
                </button>
              </div> -->
              <!--æ–°çš„æ•¸é‡é¸æ“‡å™¨-->
              <!-- <label class="form-label fw-semibold">æ•¸é‡ï¼š</label>
              <div class="input-group" style="width: 120px;">
                <button class="btn btn-outline-secondary" type="button"
                  @click="selectedQuantity = Math.max(1, selectedQuantity - 1)">-</button>
                <input type="number" class="form-control text-center" v-model.number="selectedQuantity" min="1" max="20"
                  :max="product.quantity">
                <button class="btn btn-outline-secondary" type="button"
                  @click="selectedQuantity = Math.min(20, Math.min(product.quantity, selectedQuantity + 1))">+</button>
              </div>-->
              <!--æ–°æ•¸é‡é¸æ“‡å™¨2-->

              <label class="form-label fw-semibold">æ•¸é‡ï¼š</label>
              <div class="input-group">
                <button class="btn btn-outline-secondary" type="button"
                  @click="selectedQuantity = Math.max(1, selectedQuantity - 1)" :disabled="selectedQuantity <= 1">
                  <i class="bi bi-dash"></i>
                </button>
                <input type="number" class="form-control text-center" v-model.number="selectedQuantity" min="1" max="20"
                  :max="product.quantity" @input="validateQuantity" @blur="validateQuantity">
                <button class="btn btn-outline-secondary" type="button"
                  @click="selectedQuantity = Math.min(20, Math.min(product.quantity, selectedQuantity + 1))"
                  :disabled="selectedQuantity >= Math.min(20, product.quantity)">
                  <i class="bi bi-plus"></i>
                </button>
              </div>
            </div>
            <!-- æ“ä½œæŒ‰éˆ• -->
            <div class="d-grid gap-2 d-md-flex">
              <!-- <button class="btn btn-primary btn-lg flex-fill me-md-2" v-on:click="addToCart"
                  v-bind:disabled="loading">
                  <i class="bi bi-cart-plus me-2"></i>
                  åŠ å…¥è³¼ç‰©è»Š
                </button> -->
              <!-- åŠ å…¥è³¼ç‰©è»ŠæŒ‰éˆ•æ”¹ç‰ˆ -->
              <button class="btn btn-cart btn-lg flex-fill me-md-2" v-on:click="addToCart"
                :disabled="addingToCart || !product || product.quantity === 0">
                <span v-if="addingToCart">
                  <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                  åŠ å…¥ä¸­...
                </span>
                <span v-else>
                  <i class="bi bi-cart-plus me-2"></i>åŠ å…¥è³¼ç‰©è»Š
                </span>
              </button>
              <!--åŠ å…¥æœ€æ„›-->
              <button class="btn btn-outline-secondary btn-lg" v-on:click="toggleFavorite(product.id)">
                <i class="bi bi-heart-fill" :class="{ 'text-danger': isFavorite(product.id) }"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="container mt-5" v-if="!loading && !error && product && Object.keys(product).length > 0">
        <div class="row">
          <div class="col-12">
            <!-- é ç±¤å°èˆª -->
            <ul class="nav nav-tabs mb-4" id="productTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link" v-bind:class="{ active: activeTab === 'content' }"
                  v-on:click="switchTab('content')" type="button">
                  <i class="bi bi-file-text me-2"></i>
                  å•†å“å…§å®¹
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" v-bind:class="{ active: activeTab === 'delivery' }"
                  v-on:click="switchTab('delivery')" type="button">
                  <i class="bi bi-truck me-2"></i>
                  é€è²¨åŠä»˜æ¬¾æ–¹å¼
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" v-bind:class="{ active: activeTab === 'notice' }"
                  v-on:click="switchTab('notice')" type="button">
                  <i class="bi bi-info-circle me-2"></i>
                  è³¼ç‰©é ˆçŸ¥
                </button>
              </li>
            </ul>

            <!-- é ç±¤å…§å®¹ -->
            <div class="tab-content">
              <!-- å•†å“å…§å®¹é ç±¤ -->
              <div v-if="activeTab === 'content'" class="tab-pane">
                <div class="card border-0 shadow-sm">
                  <div class="card-body p-4">
                    <!-- <h5 class="card-title mb-3">
                      <i class="bi bi-file-text text-primary me-2"></i>
                      å•†å“è©³ç´°èªªæ˜
                    </h5> -->
                    <div class="product-description">
                      <!-- ä½¿ç”¨ v-html ä¾†é¡¯ç¤ºHTMLæ ¼å¼çš„å•†å“æè¿° -->
                      <div v-if="product.productDescription" v-html="formatDescription(product.productDescription)">
                      </div>
                      <!-- <p v-else class="text-muted">æš«ç„¡å•†å“è©³ç´°èªªæ˜</p> -->
                    </div>
                  </div>
                </div>
              </div>

              <!-- é€è²¨åŠä»˜æ¬¾æ–¹å¼é ç±¤ -->
              <div v-if="activeTab === 'delivery'" class="tab-pane">
                <div class="card border-0 shadow-sm">
                  <div class="card-body p-4">
                    <!-- <h5 class="card-title mb-3">
                      <i class="bi bi-truck text-success me-2"></i>
                      é€è²¨åŠä»˜æ¬¾æ–¹å¼
                    </h5> -->
                    <div class="delivery-info">
                      <div v-if="productNote && productNote.deliveryAndPayMethod"
                        v-html="formatDescription(productNote.deliveryAndPayMethod)"></div>
                      <!-- <div v-else class="text-muted">
                        <p>ğŸ“¦ <strong>é€è²¨æ–¹å¼ï¼š</strong></p>
                        <ul>
                          <li>å®…é…åˆ°åºœï¼ˆå…é‹è²»æ»¿1000å…ƒï¼‰</li>
                          <li>è¶…å•†å–è²¨ï¼ˆ7-11ã€å…¨å®¶ã€èŠçˆ¾å¯Œï¼‰</li>
                        </ul>
                        <p>ğŸ’³ <strong>ä»˜æ¬¾æ–¹å¼ï¼š</strong></p>
                        <ul>
                          <li>ç·šä¸Šåˆ·å¡</li>
                          <li>ATMè½‰å¸³</li>
                          <li>è¶…å•†ä»˜æ¬¾</li>
                          <li>è²¨åˆ°ä»˜æ¬¾</li>
                        </ul>
                      </div> -->
                    </div>
                  </div>
                </div>
              </div>

              <!-- è³¼ç‰©é ˆçŸ¥é ç±¤ -->
              <div v-if="activeTab === 'notice'" class="tab-pane">
                <div class="card border-0 shadow-sm">
                  <div class="card-body p-4">
                    <!-- <h5 class="card-title mb-3">
                      <i class="bi bi-info-circle text-warning me-2"></i>
                      è³¼ç‰©é ˆçŸ¥
                    </h5> -->
                    <div class="shopping-notice">
                      <div v-if="productNote && productNote.shoppNote"
                        v-html="formatDescription(productNote.shoppNote)">
                      </div>
                      <!-- <div v-else class="text-muted">
                        <h6>âš ï¸ æ³¨æ„äº‹é …ï¼š</h6>
                        <ul>
                          <li>å•†å“ç…§ç‰‡åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›å•†å“ä»¥å‡ºè²¨ç‚ºæº–</li>
                          <li>ä¿å­˜æœŸé™æ¨™ç¤ºæ–¼å•†å“åŒ…è£ä¸Š</li>
                          <li>è«‹ç½®æ–¼é™°æ¶¼ä¹¾ç‡¥è™•ä¿å­˜ï¼Œé¿å…é™½å…‰ç›´å°„</li>
                          <li>é–‹å°å¾Œè«‹å„˜é€Ÿé£Ÿç”¨å®Œç•¢</li>
                        </ul>
                        <h6>ğŸ”„ é€€æ›è²¨æ”¿ç­–ï¼š</h6>
                        <ul>
                          <li>å•†å“åˆ°è²¨äº«7å¤©é‘‘è³æœŸï¼ˆéè©¦ç”¨æœŸï¼‰</li>
                          <li>é€€è²¨å•†å“å¿…é ˆæ˜¯å…¨æ–°æœªä½¿ç”¨ç‹€æ…‹</li>
                          <li>å€‹äººè¡›ç”Ÿç”¨å“æ•ä¸æ¥å—é€€æ›è²¨</li>
                        </ul>
                      </div> -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>



      <!-- è¼‰å…¥ä¸­ç•«é¢ -->
      <div v-else-if="loading" class="container mt-5">
        <div class="row justify-content-center">
          <div class="col-md-6 text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">è¼‰å…¥ä¸­...</span>
            </div>
            <p class="mt-3">è¼‰å…¥å•†å“è³‡è¨Šä¸­...</p>
          </div>
        </div>
      </div>

      <!-- éŒ¯èª¤ç•«é¢ -->
      <div v-else-if="error" class="container mt-5">
        <div class="row justify-content-center">
          <div class="col-md-8 text-center">
            <div class="alert alert-danger">
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
              <strong>è¼‰å…¥å¤±æ•—</strong>
              <p class="mb-0 mt-2">{{ error }}</p>
            </div>
            <button class="btn btn-primary mt-3" v-on:click="loadProductDetail">
              <i class="bi bi-arrow-clockwise me-2"></i>
              é‡æ–°è¼‰å…¥
            </button>
            <a href="/VitalBridge/ECshop/category.html" class="btn btn-outline-secondary mt-3 ms-2">
              <i class="bi bi-grid-fill me-2"></i>
              ç€è¦½å•†å“
            </a>
          </div>
        </div>
      </div>
    </div>
  </main>
  <div class="footerpage"></div>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>
  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/assets/vendor/php-email-form/validate.js"></script>
  <script src="/assets/vendor/aos/aos.js"></script>
  <script src="/assets/vendor/waypoints/noframework.waypoints.js"></script>
  <script src="/assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="/assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="/assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="/assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- Main JS File -->
  <!-- <script src="assets/js/main.js"></script> -->


  <!-- å…¶ä»–è¦è£çš„jsæ”¾åœ¨é€™ä¹‹å‰ -->
  <script src="/assets/js/fragment-loader.js" defer></script>



</body>

<!-- Simple page hook: åœ¨ä¸‹é¢å€å¡Šç›´æ¥å¯«é é¢å°ˆå±¬çš„ JSï¼ˆæ­¤å‡½å¼æœƒç­‰åˆ° fragment-loader ç™¼å‡º app:ready ä¸” window.load å®Œæˆå¾ŒåŸ·è¡Œï¼‰ -->
<script>
  (function onFullyReady(run) {
    function once(ev) { return new Promise(res => { function h(e) { window.removeEventListener(ev, h); res(e); } window.addEventListener(ev, h); }); }
    function waitAppReady() { if (window.appReadyAt !== undefined) return Promise.resolve(); return once('app:ready'); }
    function waitWindowLoad() { if (document.readyState === 'complete') return Promise.resolve(); return once('load'); }
    Promise.all([waitAppReady(), waitWindowLoad()]).then(run).catch(function (e) { console.error('post-load hook error', e); });
  })(function () {
    // ===== åœ¨ä¸‹é¢æ”¾é é¢å°ˆå±¬çš„ JSï¼ˆåªæœƒåœ¨æ‰€æœ‰ç‰‡æ®µèˆ‡è³‡æºè¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œï¼‰ =====
    // ä¾‹å¦‚ï¼š
    // $(document).ready(function () {
    //   console.log("âœ… jQuery .ready() æ¸¬è©¦æˆåŠŸï¼");
    //   $("#hero h2").after("<p style='color:red;font-weight:bold;'>jQuery æ¸¬è©¦æ–‡å­—ï¼šè®€å–æˆåŠŸï¼</p>");
    // });

    //Vueçš„éƒ¨åˆ†å¯«é€™é‚Š
    (function mountVue() {
      // æŠŠé é¢å°ˆå±¬çš„ Vue ç¨‹å¼å¯«åœ¨é€™å€‹å‡½å¼è£¡
      function initPageVue() {
        if (typeof Vue === 'undefined') return; // è‹¥æœªè¼‰å…¥ Vue å‰‡è·³é
        const { createApp } = Vue;
        // ç¯„ä¾‹ï¼šæŠŠå¯¦éš›ç¨‹å¼æ”¹æˆä½ è¦çš„å…§å®¹

        createApp({
          data() { // data å°±æ˜¯Model
            return {
              productId: null,
              product: {},
              productNote: {},
              categoryPath: [], // æ–°å¢ï¼šé¡åˆ¥è·¯å¾‘
              mainImage: '',
              quantity: 1,
              activeTab: 'content',
              loading: true,
              error: null,
              baseApiUrl: 'https://localhost:7104',
              favorites: JSON.parse(localStorage.getItem('vitalbridge_favorites') || '[]'),
              product: null,
              selectedQuantity: 1,
              addingToCart: false, // æ–°å¢ï¼šæ˜¯å¦æ­£åœ¨åŠ å…¥è³¼ç‰©è»Šçš„ç‹€æ…‹
            };
          },
          mounted() {
            console.log('=== Product detail Vue mounted ===');
            console.log('ç•¶å‰æ™‚é–“:', new Date().toLocaleString());

            this.getProductIdFromUrl();

            console.log('æª¢æŸ¥ productId:', this.productId);
            console.log('productId é¡å‹:', typeof this.productId);
            console.log('productId > 0:', this.productId > 0);

            if (this.productId && this.productId > 0 && !isNaN(this.productId)) {
              console.log('âœ… æº–å‚™è¼‰å…¥å•†å“ID:', this.productId);
              this.loadProductDetail();
            } else {
              console.error('âŒ å•†å“IDç„¡æ•ˆ:', this.productId);
              this.error = `ç„¡æ³•å–å¾—æœ‰æ•ˆçš„å•†å“IDã€‚è§£æçµæœ: ${this.productId}`;
              this.loading = false;
            }
          },
          methods: { // methods å°±æ˜¯Controller


            // å¾ URL å–å¾—å•†å“ ID
            getProductIdFromUrl() {
              console.log('=== URL åƒæ•¸è§£æé–‹å§‹ ===');
              console.log('å®Œæ•´ URL:', window.location.href);
              console.log('pathname:', window.location.pathname);
              console.log('search:', window.location.search);
              console.log('hash:', window.location.hash);

              const urlParams = new URLSearchParams(window.location.search);

              // åˆ—å‡ºæ‰€æœ‰åƒæ•¸
              console.log('æ‰€æœ‰ URL åƒæ•¸:');
              for (const [key, value] of urlParams) {
                console.log(`  ${key}: ${value}`);
              }

              const id = urlParams.get('id');
              console.log('å–å¾—çš„ id å€¼:', id);
              console.log('id çš„é¡å‹:', typeof id);

              if (id && id.trim() !== '') {
                this.productId = parseInt(id, 10);
                console.log('è½‰æ›å¾Œçš„å•†å“ID:', this.productId);
                console.log('è½‰æ›å¾Œæ˜¯å¦ç‚ºæ•¸å­—:', !isNaN(this.productId));
              } else {
                console.error('âŒ ç„¡æ³•å–å¾—æœ‰æ•ˆçš„ id åƒæ•¸');
                this.productId = null;
              }

              console.log('=== URL åƒæ•¸è§£æçµæŸ ===');
            },
            // ç”Ÿæˆé¡åˆ¥é é¢çš„ URLï¼ˆè™•ç†ä¸åŒæ ¼å¼çš„ category ç‰©ä»¶ï¼‰
            // ç”Ÿæˆé¡åˆ¥é é¢çš„ URLï¼ˆè™•ç†ä¸åŒæ ¼å¼çš„ category ç‰©ä»¶ï¼‰
            getCategoryUrl(category) {
              if (!category) {
                return '/VitalBridge/ECshop/category.html';
              }

              // è™•ç†ä¸åŒçš„ category ç‰©ä»¶æ ¼å¼
              const categoryId = category.id || category.Id;
              const categoryName = category.name || category.Name;

              if (!categoryId) {
                return '/VitalBridge/ECshop/category.html';
              }

              // ä½¿ç”¨å¯¦éš›çš„ URL æ ¼å¼ï¼šcategoryId + nameï¼ˆURLç·¨ç¢¼ï¼‰
              const encodedName = encodeURIComponent(categoryName || '');
              return `/VitalBridge/ECshop/category.html?categoryId=${categoryId}&name=${encodedName}`;
            },

            // è¼‰å…¥å•†å“è©³æƒ…
            async loadProductDetail() {
              try {
                this.loading = true;
                this.error = null;

                console.log(`æ­£åœ¨è¼‰å…¥å•†å“ ID: ${this.productId}`);

                const response = await fetch(`${this.baseApiUrl}/api/ProductsApi/Product/${this.productId}`);

                if (!response.ok) {
                  throw new Error(`API å‘¼å«å¤±æ•—: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                this.product = data.product;
                this.productNote = data.productNote;
                // ğŸ”¥ æ–°å¢ï¼šç›´æ¥å¾ API è³‡æ–™å»ºç«‹é¡åˆ¥è·¯å¾‘
                this.buildCategoryPathFromProduct();
                console.log('=== API å›å‚³å®Œæ•´è³‡æ–™ ===');
                console.log('å®Œæ•´å›æ‡‰:', data);

                // // æª¢æŸ¥ API å›å‚³æ ¼å¼
                // if (data.isSuccess !== undefined) {
                //   if (data.isSuccess) {
                //     this.product = data.data.product;
                //     this.productNote = data.data.productNote;
                //   } else {
                //     this.error = data.message || 'è¼‰å…¥å•†å“è³‡æ–™å¤±æ•—';
                //     return;
                //   }
                // } else if (data.product) {
                //   this.product = data.product;
                //   this.productNote = data.productNote;
                // } else {
                //   console.error('âŒ æœªçŸ¥çš„ API å›å‚³æ ¼å¼:', data);
                //   this.error = 'ç„¡æ³•è§£æ API å›å‚³è³‡æ–™æ ¼å¼';
                //   return;
                // }

                // console.log('âœ… å•†å“è³‡æ–™è¼‰å…¥æˆåŠŸ');
                // console.log('å•†å“é¡åˆ¥:', this.product.categories);

                // // è¼‰å…¥é¡åˆ¥è·¯å¾‘
                // if (this.product.categories && this.product.categories.length > 0) {
                //   await this.loadCategoryPath(this.product.categories[0].id);
                // }

                // è¨­å®šä¸»åœ–
                if (this.product.images && this.product.images.length > 0) {
                  this.mainImage = this.getImageUrl(this.product.images[0].fileName);
                  this.preloadImages();
                } else {
                  this.mainImage = this.getImageUrl(null);
                }

                console.log('âœ… å•†å“è³‡æ–™è¼‰å…¥å®Œæˆ');

              } catch (error) {
                console.error(' API å‘¼å«éŒ¯èª¤:', error);
                if (error.message.includes('Failed to fetch')) {
                  this.error = `ç„¡æ³•é€£æ¥åˆ°å¾Œç«¯æœå‹™å™¨ (${this.baseApiUrl})`;
                } else {
                  this.error = `è¼‰å…¥å¤±æ•—: ${error.message}`;
                }
              } finally {
                this.loading = false;
              }
            },

            // ğŸ”¥ æ–°å¢ï¼šå¾å•†å“è³‡æ–™å»ºç«‹é¡åˆ¥è·¯å¾‘çš„æ–¹æ³•
            buildCategoryPathFromProduct() {
              if (!this.product.categories || this.product.categories.length === 0) {
                this.categoryPath = [];
                return;// å¦‚æœæ²’æœ‰é¡åˆ¥ï¼Œå‰‡æ¸…ç©ºé¡åˆ¥è·¯å¾‘
              }
              // å–ç¬¬ä¸€å€‹é¡åˆ¥ï¼ˆå·²ç¶“æŒ‰IDæ’åºï¼‰
              const mainCategory = this.product.categories[0];
              // å»ºç«‹é¡åˆ¥è·¯å¾‘é™£åˆ—
              this.categoryPath = [];
              // å¦‚æœæœ‰çˆ¶é¡åˆ¥ï¼Œå…ˆåŠ å…¥çˆ¶é¡åˆ¥
              if (mainCategory.fatherId && mainCategory.fatherName) {
                this.categoryPath.push({
                  id: mainCategory.fatherId,
                  name: mainCategory.fatherName
                });
              }
              // å†åŠ å…¥ç•¶å‰é¡åˆ¥
              this.categoryPath.push({
                id: mainCategory.id,
                name: mainCategory.name
              });
              console.log('âœ… é¡åˆ¥è·¯å¾‘å»ºç«‹å®Œæˆ:', this.categoryPath);

            },

            // æ–°å¢ï¼šé©—è­‰æ•¸é‡è¼¸å…¥
            validateQuantity() {
              // ç¢ºä¿è¼¸å…¥çš„æ•¸å€¼åœ¨æœ‰æ•ˆç¯„åœå…§
              if (this.selectedQuantity < 1) {
                this.selectedQuantity = 1;
              } else if (this.selectedQuantity > 20) {
                this.selectedQuantity = 20;
              } else if (this.selectedQuantity > this.product.quantity) {
                this.selectedQuantity = this.product.quantity;
                alert(`è¶…éåº«å­˜é‡ï¼Œå·²èª¿æ•´ç‚ºæœ€å¤§å¯è³¼è²·æ•¸é‡ï¼š${this.product.quantity}`);
              }

              // ç¢ºä¿æ˜¯æ•´æ•¸
              this.selectedQuantity = Math.floor(this.selectedQuantity);
            },


            // å–å¾—åœ–ç‰‡ URL
            // ä¿®æ­£ getImageUrl æ–¹æ³•ï¼ŒåŠ å…¥é™¤éŒ¯
            getImageUrl(fileName) {
              if (!fileName) {
                return '/assets/img/default-product.jpg';
              }
              return `https://localhost:7184/api/UploadFile/GetFile/${encodeURIComponent(fileName)}`;
            },
            // æ–°å¢é è¼‰å…¥åœ–ç‰‡æ–¹æ³•
            preloadImages() {
              console.log('é–‹å§‹é è¼‰å…¥åœ–ç‰‡...');
              if (this.product.images && this.product.images.length > 0) {
                this.product.images.forEach((imageObj, index) => {
                  const img = new Image();
                  img.onload = () => {
                    console.log(`åœ–ç‰‡ ${index + 1} é è¼‰å…¥å®Œæˆ:`, imageObj.fileName);
                  };
                  img.onerror = () => {
                    console.error(`åœ–ç‰‡ ${index + 1} é è¼‰å…¥å¤±æ•—:`, imageObj.fileName);
                  };
                  img.src = this.getImageUrl(imageObj.fileName);
                });
              }
            },

            // åœ–ç‰‡è¼‰å…¥éŒ¯èª¤è™•ç†
            handleImageError(event) {
              event.target.src = '/assets/img/default-product.jpg';
            },

            // åˆ‡æ›ä¸»åœ–
            changeMainImage(imageUrl) {
              console.log('=== åˆ‡æ›ä¸»åœ– ===');
              console.log('é»æ“Šçš„åœ–ç‰‡ URL:', imageUrl);

              // ç›´æ¥åˆ‡æ›ï¼Œç§»é™¤ä¸å¿…è¦çš„ console.log
              this.mainImage = imageUrl;
            },

            // å¢åŠ æ•¸é‡
            increaseQuantity() {
              if (this.quantity < 99) {
                this.quantity++;
              }
            },
            // æ¸›å°‘æ•¸é‡
            decreaseQuantity() {
              if (this.quantity > 1) {
                this.quantity--;
              }
            },

            // æ ¼å¼åŒ–åƒ¹æ ¼
            formatPrice(price) {
              if (!price) return '0';
              return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            },
            // åŠ å…¥è³¼ç‰©è»Š
            async addToCart() {
              // 1. æª¢æŸ¥ç™»å…¥ç‹€æ…‹
              try {
                await window.auth.me(); // æª¢æŸ¥æ˜¯å¦ç™»å…¥
              } catch (error) {
                alert('è«‹å…ˆç™»å…¥æœƒå“¡æ‰èƒ½åŠ å…¥è³¼ç‰©è»Š');
                // å¯ä»¥è·³å‡ºç™»å…¥ modal æˆ–è·³è½‰ç™»å…¥é 
                return;
              }
              // 2. æª¢æŸ¥æ•¸é‡
              if (this.selectedQuantity < 1 || this.selectedQuantity > 20) {
                alert('æ•¸é‡å¿…é ˆåœ¨ 1-20 ä¹‹é–“');
                return;
              }
              // 3. æª¢æŸ¥åº«å­˜
              if (this.selectedQuantity > this.product.quantity) {
                alert(`åº«å­˜ä¸è¶³ï¼Œç›®å‰åº«å­˜ï¼š${this.product.quantity}`);
                return;
              }
              // 4. å‘¼å«åŠ å…¥è³¼ç‰©è»Š API
              try {
                // é–å®šæŒ‰éˆ•ï¼Œé˜²æ­¢é‡è¤‡é»æ“Š
                this.addingToCart = true;
                const response = await window.auth.apiFetch('/api/CartApi/AddItem', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    productId: this.product.id,
                    quantity: this.selectedQuantity
                  })
                });
                if (!response.ok) {
                  const errorText = await response.text();
                  throw new Error(errorText || 'åŠ å…¥è³¼ç‰©è»Šå¤±æ•—');
                }
                // 5. æˆåŠŸè™•ç†
                const result = await response.text();
                alert(result || 'æˆåŠŸåŠ å…¥è³¼ç‰©è»Šï¼');

                // 6. æ›´æ–°å°è¦½åˆ—è³¼ç‰©è»Šæ•¸é‡
                await this.updateCartCount();
              }
              catch (error) {
                console.error('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—:', error);
                alert(error.message || 'åŠ å…¥è³¼ç‰©è»Šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
              }
              finally {
                this.addingToCart = false;
              }
            },

            // æ–°å¢ï¼šæ›´æ–°è³¼ç‰©è»Šæ•¸é‡çš„æ–¹æ³•
            async updateCartCount() {
              try {
                const response = await window.auth.apiFetch('/api/CartApi/Count', {
                  method: 'GET'
                });

                if (response.ok) {
                  const count = await response.json();
                  const cartCountElement = document.getElementById('cart-count');
                  if (cartCountElement) {
                    cartCountElement.textContent = count || 0;
                  }
                }
              } catch (error) {
                console.error('æ›´æ–°è³¼ç‰©è»Šæ•¸é‡å¤±æ•—:', error);
              }
            },

            // åˆ‡æ›æˆ‘çš„æœ€æ„›
            toggleFavorite(productId) {
              const index = this.favorites.indexOf(productId);
              if (index > -1) {
                this.favorites.splice(index, 1);
              } else {
                this.favorites.push(productId);
              }
              localStorage.setItem('vitalbridge_favorites', JSON.stringify(this.favorites));
            },
            // æª¢æŸ¥æ˜¯å¦ç‚ºæˆ‘çš„æœ€æ„›
            isFavorite(productId) {
              return this.favorites.includes(productId);
            },
            // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
            checkLoginStatus() {
              return false; // æš«æ™‚å›å‚³ false
            },
            switchTab: function (tab) {
              this.activeTab = tab;
              console.log('åˆ‡æ›åˆ°é ç±¤:', tab);
            },
            // æ ¼å¼åŒ–æè¿°æ–‡å­—
            formatDescription: function (text) {
              if (!text) return '';
              // å…ˆè™•ç† \r\nï¼Œå†è™•ç†å–®ç¨çš„ \n
              return text.replace(/\r\n/g, '<br>').replace(/\n/g, '<br>');
            },


          },
        }).mount('#product-detail-app');
        // Vue å¯¦ä¾‹æ›è¼‰æˆåŠŸ
        console.log(" Product detail Vue mount æˆåŠŸï¼");
      }
      // ç«‹å³åŸ·è¡Œï¼ˆå¤–å±¤ post-load å·²ç¢ºä¿æ™‚æ©Ÿæ­£ç¢ºï¼‰
      initPageVue();
    })();
    // ===== åœ¨ä¸Šé¢æ”¾é é¢å°ˆå±¬çš„ JSï¼ˆåªæœƒåœ¨æ‰€æœ‰ç‰‡æ®µèˆ‡è³‡æºè¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œï¼‰ =====
  });
</script>

</html>